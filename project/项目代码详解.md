# é…’åº—ç®¡ç†ç³»ç»Ÿ - é¡¹ç›®ä»£ç è¯¦è§£

## ğŸ“š æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†è§£é‡Šé¡¹ç›®ä¸­æ¯ä¸ªéè‡ªåŠ¨ç”Ÿæˆçš„ä»£ç æ–‡ä»¶çš„åŠŸèƒ½ã€ä½œç”¨å’Œå®ç°é€»è¾‘ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿç†è§£é¡¹ç›®ç»“æ„å’Œä»£ç ç»†èŠ‚ã€‚

---

## ğŸ“‚ ç›®å½•ç»“æ„

```
src/main/
â”œâ”€â”€ java/com/hotel/          # Javaæºä»£ç 
â”‚   â”œâ”€â”€ config/              # é…ç½®ç±»ï¼ˆæ‹¦æˆªå™¨ï¼‰
â”‚   â”œâ”€â”€ controller/          # æ§åˆ¶å™¨å±‚
â”‚   â”œâ”€â”€ dao/                 # æ•°æ®è®¿é—®å±‚æ¥å£
â”‚   â”œâ”€â”€ entity/              # å®ä½“ç±»
â”‚   â””â”€â”€ service/             # ä¸šåŠ¡é€»è¾‘å±‚
â”‚       â””â”€â”€ impl/            # ä¸šåŠ¡é€»è¾‘å®ç°
â”œâ”€â”€ resources/               # èµ„æºæ–‡ä»¶
â”‚   â”œâ”€â”€ mapper/              # MyBatisæ˜ å°„æ–‡ä»¶
â”‚   â”œâ”€â”€ applicationContext.xml
â”‚   â”œâ”€â”€ db.properties
â”‚   â”œâ”€â”€ logback.xml
â”‚   â”œâ”€â”€ mybatis-config.xml
â”‚   â””â”€â”€ spring-mvc.xml
â””â”€â”€ webapp/                  # Webèµ„æº
    â”œâ”€â”€ views/               # JSPè§†å›¾
    â””â”€â”€ WEB-INF/web.xml
```

---

## ğŸ¯ ä¸€ã€å®ä½“ç±»ï¼ˆEntityï¼‰

å®ä½“ç±»å¯¹åº”æ•°æ®åº“è¡¨ç»“æ„ï¼Œä½¿ç”¨ Lombok ç®€åŒ–ä»£ç ã€‚

### 1.1 User.java - ç”¨æˆ·å®ä½“ç±»

**æ–‡ä»¶è·¯å¾„**: `src/main/java/com/hotel/entity/User.java`

**åŠŸèƒ½è¯´æ˜**: 
- å¯¹åº”æ•°æ®åº“ `user` è¡¨
- å­˜å‚¨ç”¨æˆ·å’Œç®¡ç†å‘˜ä¿¡æ¯
- ä½¿ç”¨ `@Data` æ³¨è§£è‡ªåŠ¨ç”Ÿæˆ getter/setter


**ä»£ç è§£æ**:
```java
@Data  // Lombokæ³¨è§£ï¼Œè‡ªåŠ¨ç”Ÿæˆgetter/setter/toString/equals/hashCode
public class User {
    private Long userId;           // ç”¨æˆ·IDï¼Œä¸»é”®
    private String userName;       // ç”¨æˆ·åï¼Œç™»å½•è´¦å·
    private String password;       // å¯†ç 
    private String realName;       // çœŸå®å§“å
    private String phone;          // æ‰‹æœºå·
    private String email;          // é‚®ç®±
    private String avatar;         // å¤´åƒURL
    private Integer userType;      // ç”¨æˆ·ç±»å‹ï¼š0-æ™®é€šç”¨æˆ·ï¼Œ1-ç®¡ç†å‘˜
    private Integer status;        // çŠ¶æ€ï¼š0-ç¦ç”¨ï¼Œ1-æ­£å¸¸
    private Date createTime;       // åˆ›å»ºæ—¶é—´
    private Date updateTime;       // æ›´æ–°æ—¶é—´
    private String remark;         // å¤‡æ³¨
}
```

**å­—æ®µè¯´æ˜**:
- `userType`: åŒºåˆ†æ™®é€šç”¨æˆ·å’Œç®¡ç†å‘˜ï¼Œç”¨äºæƒé™æ§åˆ¶
- `status`: æ§åˆ¶è´¦å·æ˜¯å¦å¯ç”¨ï¼Œç¦ç”¨åæ— æ³•ç™»å½•
- `avatar`: å­˜å‚¨å¤´åƒå›¾ç‰‡çš„è®¿é—®URL

**å¯¹åº”åŠŸèƒ½**:
- ç”¨æˆ·ç™»å½•/æ³¨å†Œ
- ç®¡ç†å‘˜ç™»å½•
- ä¼šå‘˜ç®¡ç†
- ä¸ªäººä¿¡æ¯ç®¡ç†

---

### 1.2 RoomCategory.java - æˆ¿é—´åˆ†ç±»å®ä½“ç±»

**æ–‡ä»¶è·¯å¾„**: `src/main/java/com/hotel/entity/RoomCategory.java`

**åŠŸèƒ½è¯´æ˜**:
- å¯¹åº”æ•°æ®åº“ `room_category` è¡¨
- å­˜å‚¨æˆ¿é—´åˆ†ç±»ä¿¡æ¯ï¼ˆå¦‚è±ªåå¥—æˆ¿ã€æ ‡å‡†é—´ï¼‰
- ç”¨äºæˆ¿é—´åˆ†ç±»ç®¡ç†å’Œå±•ç¤º

**ä»£ç è§£æ**:
```java
@Data
public class RoomCategory {
    private Long categoryId;       // åˆ†ç±»IDï¼Œä¸»é”®
    private String categoryName;   // åˆ†ç±»åç§°ï¼Œå¦‚"è±ªåå¥—æˆ¿"
    private String description;    // åˆ†ç±»æè¿°
    private Double priceMin;       // è¯¥åˆ†ç±»æœ€ä½ä»·æ ¼
    private Double priceMax;       // è¯¥åˆ†ç±»æœ€é«˜ä»·æ ¼
    private String coverImg;       // å°é¢å›¾ç‰‡URL
    private Integer sort;          // æ’åºå­—æ®µï¼Œæ•°å­—è¶Šå°è¶Šé å‰
    private Integer status;        // çŠ¶æ€ï¼š0-ç¦ç”¨ï¼Œ1-å¯ç”¨
    private Date createTime;       // åˆ›å»ºæ—¶é—´
    private Date updateTime;       // æ›´æ–°æ—¶é—´
    private String remark;         // å¤‡æ³¨
}
```

**å­—æ®µè¯´æ˜**:
- `priceMin/priceMax`: ä»·æ ¼åŒºé—´ï¼Œç”¨äºç­›é€‰å’Œå±•ç¤º
- `coverImg`: åˆ†ç±»å±•ç¤ºå›¾ç‰‡ï¼Œå­˜å‚¨åœ¨ `/uploads/categories/` ç›®å½•
- `sort`: æ§åˆ¶åˆ†ç±»åœ¨åˆ—è¡¨ä¸­çš„æ˜¾ç¤ºé¡ºåº

**å¯¹åº”åŠŸèƒ½**:
- æˆ¿é—´åˆ†ç±»ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
- æˆ¿é—´åˆ†ç±»å±•ç¤º
- ä»·æ ¼åŒºé—´ç­›é€‰

---

### 1.3 RoomInfo.java - æˆ¿é—´ä¿¡æ¯å®ä½“ç±»

**æ–‡ä»¶è·¯å¾„**: `src/main/java/com/hotel/entity/RoomInfo.java`

**åŠŸèƒ½è¯´æ˜**:
- å¯¹åº”æ•°æ®åº“ `room_info` è¡¨
- å­˜å‚¨å…·ä½“æˆ¿é—´ä¿¡æ¯
- å…³è”æˆ¿é—´åˆ†ç±»

**ä»£ç è§£æ**:
```java
@Data
public class RoomInfo {
    private Long roomId;           // æˆ¿é—´IDï¼Œä¸»é”®
    private Long categoryId;       // åˆ†ç±»IDï¼Œå¤–é”®å…³è”room_category
    private String roomNo;         // æˆ¿é—´å·ï¼Œå¦‚"101"ã€"202"
    private Double area;           // æˆ¿é—´é¢ç§¯ï¼ˆå¹³æ–¹ç±³ï¼‰
    private String bedType;        // åºŠå‹ï¼Œå¦‚"å¤§åºŠ"ã€"åŒåºŠ"
    private Double price;          // æˆ¿é—´å•ä»·ï¼ˆå…ƒ/å¤©ï¼‰
    private String facilities;     // è®¾æ–½æè¿°ï¼Œå¦‚"ç©ºè°ƒã€WiFiã€ç”µè§†"
    private String coverImg;       // å°é¢å›¾ç‰‡URL
    private String detailImgs;     // è¯¦æƒ…å›¾ç‰‡ï¼Œå¤šå¼ å›¾ç‰‡ç”¨é€—å·åˆ†éš”
    private Integer roomStatus;    // æˆ¿é—´çŠ¶æ€ï¼š0-å¯é¢„è®¢ï¼Œ1-ç»´æŠ¤ä¸­ï¼Œ2-å·²å…¥ä½
    private Date createTime;       // åˆ›å»ºæ—¶é—´
    private Date updateTime;       // æ›´æ–°æ—¶é—´
    private String remark;         // å¤‡æ³¨
}
```

**å­—æ®µè¯´æ˜**:
- `roomNo`: å”¯ä¸€æ ‡è¯†æˆ¿é—´ï¼Œä¸èƒ½é‡å¤
- `roomStatus`: 
  - 0-å¯é¢„è®¢ï¼šç”¨æˆ·å¯ä»¥é¢„è®¢
  - 1-ç»´æŠ¤ä¸­ï¼šæš‚æ—¶ä¸å¯é¢„è®¢
  - 2-å·²å…¥ä½ï¼šæœ‰å®¢äººå…¥ä½ï¼Œä¸å¯é¢„è®¢
- `detailImgs`: å¤šå¼ å›¾ç‰‡URLç”¨é€—å·åˆ†éš”ï¼Œå¦‚ "url1.jpg,url2.jpg,url3.jpg"

**å¯¹åº”åŠŸèƒ½**:
- æˆ¿é—´ä¿¡æ¯ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
- æˆ¿é—´åˆ—è¡¨å±•ç¤º
- æˆ¿é—´è¯¦æƒ…é¡µ
- æˆ¿é—´é¢„è®¢

---

### 1.4 Order.java - è®¢å•å®ä½“ç±»

**æ–‡ä»¶è·¯å¾„**: `src/main/java/com/hotel/entity/Order.java`

**åŠŸèƒ½è¯´æ˜**:
- å¯¹åº”æ•°æ®åº“ `orders` è¡¨
- å­˜å‚¨è®¢å•ä¿¡æ¯
- å…³è”ç”¨æˆ·å’Œæˆ¿é—´

**ä»£ç è§£æ**:
```java
@Data
public class Order {
    private Long orderId;              // è®¢å•IDï¼Œä¸»é”®
    private String orderNo;            // è®¢å•å·ï¼Œå”¯ä¸€æ ‡è¯†
    private Long userId;               // ç”¨æˆ·IDï¼Œå¤–é”®
    private String userName;           // ç”¨æˆ·åï¼ˆå…³è”æŸ¥è¯¢å­—æ®µï¼Œä¸å­˜æ•°æ®åº“ï¼‰
    private Long roomId;               // æˆ¿é—´IDï¼Œå¤–é”®
    private Long categoryId;           // æˆ¿é—´åˆ†ç±»ID
    private String guestName;          // å…¥ä½äººå§“å
    private String phone;              // è”ç³»ç”µè¯
    private Date checkInDate;          // å…¥ä½æ—¥æœŸ
    private Date checkOutDate;         // é€€æˆ¿æ—¥æœŸ
    private Integer stayDays;          // å…¥ä½å¤©æ•°
    private BigDecimal roomPrice;      // æˆ¿é—´å•ä»·ï¼ˆä¸‹å•æ—¶çš„ä»·æ ¼ï¼‰
    private BigDecimal totalPrice;     // è®¢å•æ€»ä»· = å•ä»· Ã— å¤©æ•°
    private Integer orderStatus;       // è®¢å•çŠ¶æ€
    private String specialRequests;    // ç‰¹æ®Šè¦æ±‚
    private String cancelReason;       // å–æ¶ˆåŸå› 
    private Date createTime;           // åˆ›å»ºæ—¶é—´
    private Date updateTime;           // æ›´æ–°æ—¶é—´
    private String remark;             // å¤‡æ³¨
}
```

**å­—æ®µè¯´æ˜**:
- `orderNo`: æ ¼å¼ä¸º "ORDER" + æ—¶é—´æˆ³ï¼Œä¿è¯å”¯ä¸€æ€§
- `orderStatus`: è®¢å•çŠ¶æ€æµè½¬
  - 0-å¾…ç¡®è®¤ï¼šç”¨æˆ·åˆšä¸‹å•
  - 1-å·²ç¡®è®¤ï¼šç®¡ç†å‘˜ç¡®è®¤è®¢å•
  - 2-å·²å…¥ä½ï¼šå®¢äººå·²åŠç†å…¥ä½
  - 3-å·²å®Œæˆï¼šå®¢äººå·²é€€æˆ¿
  - 4-å·²å–æ¶ˆï¼šè®¢å•è¢«å–æ¶ˆ
- `userName`: éæ•°æ®åº“å­—æ®µï¼Œç”¨äºé¡µé¢å±•ç¤ºï¼Œé€šè¿‡å…³è”æŸ¥è¯¢è·å–
- `roomPrice`: ä¿å­˜ä¸‹å•æ—¶çš„ä»·æ ¼ï¼Œé¿å…åç»­ä»·æ ¼å˜åŠ¨å½±å“è®¢å•

**å¯¹åº”åŠŸèƒ½**:
- è®¢å•ç®¡ç†ï¼ˆæŸ¥è¯¢ã€ç¡®è®¤ã€å…¥ä½ã€å®Œæˆã€å–æ¶ˆï¼‰
- ç”¨æˆ·è®¢å•æŸ¥è¯¢
- æˆ¿é—´é¢„è®¢
- ç»Ÿè®¡æŠ¥è¡¨

---


## ğŸ—„ï¸ äºŒã€æ•°æ®è®¿é—®å±‚ï¼ˆDAOï¼‰

DAO å±‚å®šä¹‰æ•°æ®åº“æ“ä½œæ¥å£ï¼Œç”± MyBatis å®ç°ã€‚

### 2.1 UserDao.java - ç”¨æˆ·æ•°æ®è®¿é—®æ¥å£

**æ–‡ä»¶è·¯å¾„**: `src/main/java/com/hotel/dao/UserDao.java`

**åŠŸèƒ½è¯´æ˜**: å®šä¹‰ç”¨æˆ·è¡¨çš„æ•°æ®åº“æ“ä½œæ–¹æ³•

**æ ¸å¿ƒæ–¹æ³•**:
```java
public interface UserDao {
    // æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ï¼ˆç”¨äºç™»å½•éªŒè¯ï¼‰
    User findByUserName(String userName);
    
    // æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·
    User findById(Long userId);
    
    // æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
    List<User> findAll();
    
    // æ¡ä»¶æŸ¥è¯¢ç”¨æˆ·ï¼ˆåˆ†é¡µï¼‰
    List<User> findByConditionsPaged(
        @Param("userName") String userName,
        @Param("realName") String realName,
        @Param("phone") String phone,
        @Param("status") Integer status,
        @Param("userType") Integer userType,
        @Param("offset") int offset,
        @Param("limit") int limit
    );
    
    // ç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„ç”¨æˆ·æ•°é‡
    int countByConditions(
        @Param("userName") String userName,
        @Param("realName") String realName,
        @Param("phone") String phone,
        @Param("status") Integer status,
        @Param("userType") Integer userType
    );
    
    // æ’å…¥æ–°ç”¨æˆ·
    int insert(User user);
    
    // æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆå…¨éƒ¨å­—æ®µï¼‰
    int update(User user);
    
    // æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆåªæ›´æ–°éç©ºå­—æ®µï¼‰
    int updateSelective(User user);
    
    // åˆ é™¤ç”¨æˆ·
    int deleteById(Long userId);
}
```

**æ–¹æ³•è¯´æ˜**:
- `@Param`: MyBatis æ³¨è§£ï¼Œç”¨äºå¤šå‚æ•°æ˜ å°„
- `findByConditionsPaged`: æ”¯æŒå¤šæ¡ä»¶ç»„åˆæŸ¥è¯¢å’Œåˆ†é¡µ
- `updateSelective`: åªæ›´æ–°ä¼ å…¥çš„éç©ºå­—æ®µï¼Œé¿å…è¦†ç›–å…¶ä»–æ•°æ®

**å¯¹åº” Mapper**: `src/main/resources/mapper/UserDao.xml`

**å¯¹åº”åŠŸèƒ½**:
- ç”¨æˆ·ç™»å½•éªŒè¯
- ä¼šå‘˜ç®¡ç†
- ç®¡ç†å‘˜ç®¡ç†
- ä¸ªäººä¿¡æ¯ä¿®æ”¹

---

### 2.2 RoomCategoryDao.java - æˆ¿é—´åˆ†ç±»æ•°æ®è®¿é—®æ¥å£

**æ–‡ä»¶è·¯å¾„**: `src/main/java/com/hotel/dao/RoomCategoryDao.java`

**åŠŸèƒ½è¯´æ˜**: å®šä¹‰æˆ¿é—´åˆ†ç±»è¡¨çš„æ•°æ®åº“æ“ä½œæ–¹æ³•

**æ ¸å¿ƒæ–¹æ³•**:
```java
public interface RoomCategoryDao {
    // æŸ¥è¯¢æ‰€æœ‰åˆ†ç±»
    List<RoomCategory> findAll();
    
    // æ ¹æ®IDæŸ¥è¯¢åˆ†ç±»
    RoomCategory findById(Long categoryId);
    
    // æ¡ä»¶æŸ¥è¯¢åˆ†ç±»ï¼ˆåˆ†é¡µï¼‰
    List<RoomCategory> findByConditionsPaged(
        @Param("categoryName") String categoryName,
        @Param("priceMin") Double priceMin,
        @Param("priceMax") Double priceMax,
        @Param("offset") int offset,
        @Param("limit") int limit
    );
    
    // ç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„åˆ†ç±»æ•°é‡
    int countByConditions(
        @Param("categoryName") String categoryName,
        @Param("priceMin") Double priceMin,
        @Param("priceMax") Double priceMax
    );
    
    // æ’å…¥æ–°åˆ†ç±»
    int insert(RoomCategory category);
    
    // æ›´æ–°åˆ†ç±»ä¿¡æ¯
    int update(RoomCategory category);
    
    // åˆ é™¤åˆ†ç±»
    int deleteById(Long categoryId);
}
```

**å¯¹åº” Mapper**: `src/main/resources/mapper/RoomCategoryDao.xml`

**å¯¹åº”åŠŸèƒ½**:
- æˆ¿é—´åˆ†ç±»ç®¡ç†
- æˆ¿é—´åˆ†ç±»å±•ç¤º
- ä»·æ ¼åŒºé—´ç­›é€‰

---

### 2.3 RoomInfoDao.java - æˆ¿é—´ä¿¡æ¯æ•°æ®è®¿é—®æ¥å£

**æ–‡ä»¶è·¯å¾„**: `src/main/java/com/hotel/dao/RoomInfoDao.java`

**åŠŸèƒ½è¯´æ˜**: å®šä¹‰æˆ¿é—´ä¿¡æ¯è¡¨çš„æ•°æ®åº“æ“ä½œæ–¹æ³•

**æ ¸å¿ƒæ–¹æ³•**:
```java
public interface RoomInfoDao {
    // æŸ¥è¯¢æ‰€æœ‰æˆ¿é—´
    List<RoomInfo> findAll();
    
    // æ ¹æ®IDæŸ¥è¯¢æˆ¿é—´
    RoomInfo findById(Long roomId);
    
    // æ ¹æ®åˆ†ç±»IDæŸ¥è¯¢æˆ¿é—´åˆ—è¡¨
    List<RoomInfo> findByCategoryId(Long categoryId);
    
    // æ¡ä»¶æŸ¥è¯¢æˆ¿é—´ï¼ˆæ”¯æŒå¤šæ¡ä»¶ç»„åˆï¼‰
    List<RoomInfo> findByConditions(
        @Param("roomNo") String roomNo,
        @Param("categoryId") Long categoryId,
        @Param("priceMin") BigDecimal priceMin,
        @Param("priceMax") BigDecimal priceMax,
        @Param("roomStatus") Integer roomStatus
    );
    
    // æ¡ä»¶æŸ¥è¯¢æˆ¿é—´ï¼ˆåˆ†é¡µï¼‰
    List<RoomInfo> findByConditionsPaged(
        @Param("roomNo") String roomNo,
        @Param("categoryId") Long categoryId,
        @Param("priceMin") BigDecimal priceMin,
        @Param("priceMax") BigDecimal priceMax,
        @Param("roomStatus") Integer roomStatus,
        @Param("offset") int offset,
        @Param("limit") int limit
    );
    
    // ç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„æˆ¿é—´æ•°é‡
    int countByConditions(
        @Param("roomNo") String roomNo,
        @Param("categoryId") Long categoryId,
        @Param("priceMin") BigDecimal priceMin,
        @Param("priceMax") BigDecimal priceMax,
        @Param("roomStatus") Integer roomStatus
    );
    
    // æ’å…¥æ–°æˆ¿é—´
    int insert(RoomInfo room);
    
    // æ›´æ–°æˆ¿é—´ä¿¡æ¯
    int update(RoomInfo room);
    
    // åˆ é™¤æˆ¿é—´
    int deleteById(Long roomId);
}
```

**æ–¹æ³•è¯´æ˜**:
- `findByConditions`: æ”¯æŒæˆ¿é—´å·ã€åˆ†ç±»ã€ä»·æ ¼åŒºé—´ã€çŠ¶æ€ç­‰å¤šæ¡ä»¶ç­›é€‰
- `findByCategoryId`: ç”¨äºç»Ÿè®¡æŠ¥è¡¨ï¼ŒæŒ‰åˆ†ç±»æŸ¥è¯¢æˆ¿é—´

**å¯¹åº” Mapper**: `src/main/resources/mapper/RoomInfoDao.xml`

**å¯¹åº”åŠŸèƒ½**:
- æˆ¿é—´ä¿¡æ¯ç®¡ç†
- æˆ¿é—´åˆ—è¡¨å±•ç¤º
- æˆ¿é—´æœç´¢ç­›é€‰
- ç»Ÿè®¡æŠ¥è¡¨

---

### 2.4 OrderDao.java - è®¢å•æ•°æ®è®¿é—®æ¥å£

**æ–‡ä»¶è·¯å¾„**: `src/main/java/com/hotel/dao/OrderDao.java`

**åŠŸèƒ½è¯´æ˜**: å®šä¹‰è®¢å•è¡¨çš„æ•°æ®åº“æ“ä½œæ–¹æ³•

**æ ¸å¿ƒæ–¹æ³•**:
```java
public interface OrderDao {
    // æŸ¥è¯¢æ‰€æœ‰è®¢å•
    List<Order> findAll();
    
    // æ ¹æ®IDæŸ¥è¯¢è®¢å•
    Order findById(Long orderId);
    
    // æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢è®¢å•åˆ—è¡¨
    List<Order> findByUserId(Long userId);
    
    // æ¡ä»¶æŸ¥è¯¢è®¢å•ï¼ˆåˆ†é¡µï¼‰
    List<Order> findPageByConditions(
        @Param("orderNo") String orderNo,
        @Param("guestName") String guestName,
        @Param("phone") String phone,
        @Param("userName") String userName,
        @Param("orderStatus") Integer orderStatus,
        @Param("offset") int offset,
        @Param("limit") int limit
    );
    
    // ç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„è®¢å•æ•°é‡
    int countByConditions(
        @Param("orderNo") String orderNo,
        @Param("guestName") String guestName,
        @Param("phone") String phone,
        @Param("userName") String userName,
        @Param("orderStatus") Integer orderStatus
    );
    
    // æ’å…¥æ–°è®¢å•
    int insert(Order order);
    
    // æ›´æ–°è®¢å•ä¿¡æ¯ï¼ˆåªæ›´æ–°éç©ºå­—æ®µï¼‰
    int updateSelective(Order order);
    
    // åˆ é™¤è®¢å•
    int deleteById(Long orderId);
}
```

**æ–¹æ³•è¯´æ˜**:
- `findByUserId`: ç”¨æˆ·æŸ¥è¯¢è‡ªå·±çš„è®¢å•
- `findPageByConditions`: ç®¡ç†å‘˜æŸ¥è¯¢æ‰€æœ‰è®¢å•ï¼Œæ”¯æŒå¤šæ¡ä»¶ç­›é€‰
- `updateSelective`: ç”¨äºæ›´æ–°è®¢å•çŠ¶æ€ã€å–æ¶ˆåŸå› ç­‰éƒ¨åˆ†å­—æ®µ

**å¯¹åº” Mapper**: `src/main/resources/mapper/OrderDao.xml`

**å¯¹åº”åŠŸèƒ½**:
- è®¢å•ç®¡ç†
- æˆ‘çš„è®¢å•
- è®¢å•ç»Ÿè®¡
- æ”¶å…¥ç»Ÿè®¡

---


## ğŸ’¼ ä¸‰ã€ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆServiceï¼‰

Service å±‚å°è£…ä¸šåŠ¡é€»è¾‘ï¼Œè°ƒç”¨ DAO å±‚æ“ä½œæ•°æ®åº“ã€‚

### 3.1 UserService.java - ç”¨æˆ·ä¸šåŠ¡é€»è¾‘æ¥å£

**æ–‡ä»¶è·¯å¾„**: `src/main/java/com/hotel/service/UserService.java`

**åŠŸèƒ½è¯´æ˜**: å®šä¹‰ç”¨æˆ·ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘æ–¹æ³•

**æ ¸å¿ƒæ–¹æ³•**:
```java
public interface UserService {
    // ç”¨æˆ·ç™»å½•éªŒè¯
    User login(String userName, String password);
    
    // åˆ›å»ºæ–°ç”¨æˆ·
    boolean createUser(User user);
    
    // æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·
    User findById(Long userId);
    
    // æ¡ä»¶æŸ¥è¯¢ç”¨æˆ·ï¼ˆåˆ†é¡µï¼‰
    List<User> findByConditionsPaged(
        String userName, String realName, String phone,
        Integer status, Integer userType, int page, int limit
    );
    
    // ç»Ÿè®¡ç”¨æˆ·æ•°é‡
    int countByConditions(
        String userName, String realName, String phone,
        Integer status, Integer userType
    );
    
    // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
    boolean updateUserSelective(User user);
    
    // åˆ é™¤ç”¨æˆ·
    boolean deleteUser(Long userId);
    
    // é‡ç½®å¯†ç 
    boolean resetPassword(Long userId, String newPassword);
}
```

**å®ç°ç±»**: `src/main/java/com/hotel/service/impl/UserServiceImpl.java`

**ä¸šåŠ¡é€»è¾‘**:
```java
@Service
public class UserServiceImpl implements UserService {
    @Autowired
    private UserDao userDao;
    
    @Override
    public User login(String userName, String password) {
        // 1. æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·
        User user = userDao.findByUserName(userName);
        
        // 2. éªŒè¯ç”¨æˆ·æ˜¯å¦å­˜åœ¨
        if (user == null) {
            return null;
        }
        
        // 3. éªŒè¯å¯†ç æ˜¯å¦æ­£ç¡®
        if (!password.equals(user.getPassword())) {
            return null;
        }
        
        // 4. éªŒè¯è´¦å·çŠ¶æ€
        if (user.getStatus() == 0) {
            return null; // è´¦å·å·²ç¦ç”¨
        }
        
        return user;
    }
    
    @Override
    public boolean createUser(User user) {
        // 1. è®¾ç½®é»˜è®¤å€¼
        user.setCreateTime(new Date());
        user.setStatus(1); // é»˜è®¤å¯ç”¨
        
        // 2. æ’å…¥æ•°æ®åº“
        return userDao.insert(user) > 0;
    }
    
    // ... å…¶ä»–æ–¹æ³•å®ç°
}
```

**ä¸šåŠ¡è§„åˆ™**:
- ç™»å½•æ—¶éªŒè¯ç”¨æˆ·åã€å¯†ç ã€è´¦å·çŠ¶æ€
- åˆ›å»ºç”¨æˆ·æ—¶è®¾ç½®é»˜è®¤çŠ¶æ€ä¸ºå¯ç”¨
- é‡ç½®å¯†ç æ—¶æ›´æ–° updateTime

**å¯¹åº”åŠŸèƒ½**:
- ç”¨æˆ·ç™»å½•/æ³¨å†Œ
- ä¼šå‘˜ç®¡ç†
- ä¸ªäººä¿¡æ¯ä¿®æ”¹

---

### 3.2 RoomCategoryService.java - æˆ¿é—´åˆ†ç±»ä¸šåŠ¡é€»è¾‘æ¥å£

**æ–‡ä»¶è·¯å¾„**: `src/main/java/com/hotel/service/RoomCategoryService.java`

**åŠŸèƒ½è¯´æ˜**: å®šä¹‰æˆ¿é—´åˆ†ç±»ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘æ–¹æ³•

**æ ¸å¿ƒæ–¹æ³•**:
```java
public interface RoomCategoryService {
    // æŸ¥è¯¢æ‰€æœ‰åˆ†ç±»
    List<RoomCategory> findAll();
    
    // æ ¹æ®IDæŸ¥è¯¢åˆ†ç±»
    RoomCategory findById(Long categoryId);
    
    // æ¡ä»¶æŸ¥è¯¢åˆ†ç±»ï¼ˆåˆ†é¡µï¼‰
    List<RoomCategory> findByConditionsPaged(
        String categoryName, Double priceMin, Double priceMax,
        int page, int limit
    );
    
    // ç»Ÿè®¡åˆ†ç±»æ•°é‡
    int countByConditions(
        String categoryName, Double priceMin, Double priceMax
    );
    
    // ä¿å­˜åˆ†ç±»
    boolean save(RoomCategory category);
    
    // æ›´æ–°åˆ†ç±»
    boolean update(RoomCategory category);
    
    // åˆ é™¤åˆ†ç±»
    boolean deleteById(Long categoryId);
}
```

**å®ç°ç±»**: `src/main/java/com/hotel/service/impl/RoomCategoryServiceImpl.java`

**ä¸šåŠ¡é€»è¾‘**:
```java
@Service
public class RoomCategoryServiceImpl implements RoomCategoryService {
    @Autowired
    private RoomCategoryDao roomCategoryDao;
    
    @Autowired
    private RoomInfoDao roomInfoDao;
    
    @Override
    public boolean deleteById(Long categoryId) {
        // 1. æ£€æŸ¥è¯¥åˆ†ç±»ä¸‹æ˜¯å¦æœ‰æˆ¿é—´
        List<RoomInfo> rooms = roomInfoDao.findByCategoryId(categoryId);
        if (rooms != null && !rooms.isEmpty()) {
            throw new RuntimeException("è¯¥åˆ†ç±»ä¸‹è¿˜æœ‰æˆ¿é—´ï¼Œæ— æ³•åˆ é™¤");
        }
        
        // 2. åˆ é™¤åˆ†ç±»
        return roomCategoryDao.deleteById(categoryId) > 0;
    }
    
    // ... å…¶ä»–æ–¹æ³•å®ç°
}
```

**ä¸šåŠ¡è§„åˆ™**:
- åˆ é™¤åˆ†ç±»å‰æ£€æŸ¥æ˜¯å¦æœ‰å…³è”çš„æˆ¿é—´
- ä¿å­˜æ—¶è®¾ç½®åˆ›å»ºæ—¶é—´
- æ›´æ–°æ—¶è®¾ç½®æ›´æ–°æ—¶é—´

**å¯¹åº”åŠŸèƒ½**:
- æˆ¿é—´åˆ†ç±»ç®¡ç†
- æˆ¿é—´åˆ†ç±»å±•ç¤º

---

### 3.3 RoomInfoService.java - æˆ¿é—´ä¿¡æ¯ä¸šåŠ¡é€»è¾‘æ¥å£

**æ–‡ä»¶è·¯å¾„**: `src/main/java/com/hotel/service/RoomInfoService.java`

**åŠŸèƒ½è¯´æ˜**: å®šä¹‰æˆ¿é—´ä¿¡æ¯ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘æ–¹æ³•

**æ ¸å¿ƒæ–¹æ³•**:
```java
public interface RoomInfoService {
    // æŸ¥è¯¢æ‰€æœ‰æˆ¿é—´
    List<RoomInfo> findAll();
    
    // æ ¹æ®IDæŸ¥è¯¢æˆ¿é—´
    RoomInfo findById(Long roomId);
    
    // æ ¹æ®åˆ†ç±»IDæŸ¥è¯¢æˆ¿é—´
    List<RoomInfo> findByCategoryId(Long categoryId);
    
    // æ¡ä»¶æŸ¥è¯¢æˆ¿é—´
    List<RoomInfo> findByConditions(
        String roomNo, Long categoryId,
        BigDecimal priceMin, BigDecimal priceMax,
        Integer roomStatus
    );
    
    // æ¡ä»¶æŸ¥è¯¢æˆ¿é—´ï¼ˆåˆ†é¡µï¼‰
    List<RoomInfo> findByConditionsPaged(
        String roomNo, Long categoryId,
        BigDecimal priceMin, BigDecimal priceMax,
        Integer roomStatus, int page, int limit
    );
    
    // ç»Ÿè®¡æˆ¿é—´æ•°é‡
    int countByConditions(
        String roomNo, Long categoryId,
        BigDecimal priceMin, BigDecimal priceMax,
        Integer roomStatus
    );
    
    // ä¿å­˜æˆ¿é—´
    boolean save(RoomInfo room);
    
    // æ›´æ–°æˆ¿é—´
    boolean update(RoomInfo room);
    
    // åˆ é™¤æˆ¿é—´
    boolean deleteById(Long roomId);
}
```

**å®ç°ç±»**: `src/main/java/com/hotel/service/impl/RoomInfoServiceImpl.java`

**ä¸šåŠ¡é€»è¾‘**:
```java
@Service
public class RoomInfoServiceImpl implements RoomInfoService {
    @Autowired
    private RoomInfoDao roomInfoDao;
    
    @Autowired
    private OrderDao orderDao;
    
    @Override
    public boolean deleteById(Long roomId) {
        // 1. æ£€æŸ¥è¯¥æˆ¿é—´æ˜¯å¦æœ‰æœªå®Œæˆçš„è®¢å•
        List<Order> orders = orderDao.findAll();
        for (Order order : orders) {
            if (order.getRoomId().equals(roomId) && 
                order.getOrderStatus() < 3) { // æœªå®Œæˆæˆ–æœªå–æ¶ˆ
                throw new RuntimeException("è¯¥æˆ¿é—´æœ‰æœªå®Œæˆçš„è®¢å•ï¼Œæ— æ³•åˆ é™¤");
            }
        }
        
        // 2. åˆ é™¤æˆ¿é—´
        return roomInfoDao.deleteById(roomId) > 0;
    }
    
    // ... å…¶ä»–æ–¹æ³•å®ç°
}
```

**ä¸šåŠ¡è§„åˆ™**:
- åˆ é™¤æˆ¿é—´å‰æ£€æŸ¥æ˜¯å¦æœ‰æœªå®Œæˆçš„è®¢å•
- æˆ¿é—´å·ä¸èƒ½é‡å¤
- ä¿å­˜æ—¶è®¾ç½®åˆ›å»ºæ—¶é—´

**å¯¹åº”åŠŸèƒ½**:
- æˆ¿é—´ä¿¡æ¯ç®¡ç†
- æˆ¿é—´åˆ—è¡¨å±•ç¤º
- æˆ¿é—´é¢„è®¢

---

### 3.4 OrderService.java - è®¢å•ä¸šåŠ¡é€»è¾‘æ¥å£

**æ–‡ä»¶è·¯å¾„**: `src/main/java/com/hotel/service/OrderService.java`

**åŠŸèƒ½è¯´æ˜**: å®šä¹‰è®¢å•ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘æ–¹æ³•

**æ ¸å¿ƒæ–¹æ³•**:
```java
public interface OrderService {
    // æŸ¥è¯¢æ‰€æœ‰è®¢å•
    List<Order> findAll();
    
    // æ ¹æ®IDæŸ¥è¯¢è®¢å•
    Order findById(Long orderId);
    
    // æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢è®¢å•
    List<Order> findByUserId(Long userId);
    
    // æ¡ä»¶æŸ¥è¯¢è®¢å•ï¼ˆåˆ†é¡µï¼‰
    List<Order> findPageByConditions(
        String orderNo, String guestName, String phone,
        String userName, Integer orderStatus,
        int offset, int limit
    );
    
    // ç»Ÿè®¡è®¢å•æ•°é‡
    int countByConditions(
        String orderNo, String guestName, String phone,
        String userName, Integer orderStatus
    );
    
    // åˆ›å»ºè®¢å•
    boolean createOrder(Order order);
    
    // æ›´æ–°è®¢å•ï¼ˆéƒ¨åˆ†å­—æ®µï¼‰
    boolean updateSelective(Order order);
    
    // åˆ é™¤è®¢å•
    boolean deleteById(Long orderId);
}
```

**å®ç°ç±»**: `src/main/java/com/hotel/service/impl/OrderServiceImpl.java`

**ä¸šåŠ¡é€»è¾‘**:
```java
@Service
public class OrderServiceImpl implements OrderService {
    @Autowired
    private OrderDao orderDao;
    
    @Override
    public boolean createOrder(Order order) {
        // 1. ç”Ÿæˆè®¢å•å·
        order.setOrderNo("ORDER" + System.currentTimeMillis());
        
        // 2. è®¡ç®—å…¥ä½å¤©æ•°
        long days = (order.getCheckOutDate().getTime() - 
                     order.getCheckInDate().getTime()) / (1000 * 60 * 60 * 24);
        order.setStayDays((int) days);
        
        // 3. è®¡ç®—æ€»ä»·
        BigDecimal totalPrice = order.getRoomPrice()
            .multiply(BigDecimal.valueOf(order.getStayDays()));
        order.setTotalPrice(totalPrice);
        
        // 4. è®¾ç½®é»˜è®¤çŠ¶æ€
        order.setOrderStatus(0); // å¾…ç¡®è®¤
        order.setCreateTime(new Date());
        
        // 5. æ’å…¥æ•°æ®åº“
        return orderDao.insert(order) > 0;
    }
    
    // ... å…¶ä»–æ–¹æ³•å®ç°
}
```

**ä¸šåŠ¡è§„åˆ™**:
- åˆ›å»ºè®¢å•æ—¶è‡ªåŠ¨ç”Ÿæˆè®¢å•å·
- è‡ªåŠ¨è®¡ç®—å…¥ä½å¤©æ•°å’Œæ€»ä»·
- é»˜è®¤çŠ¶æ€ä¸º"å¾…ç¡®è®¤"
- è®¢å•çŠ¶æ€æµè½¬ï¼šå¾…ç¡®è®¤ â†’ å·²ç¡®è®¤ â†’ å·²å…¥ä½ â†’ å·²å®Œæˆ

**å¯¹åº”åŠŸèƒ½**:
- è®¢å•ç®¡ç†
- æˆ¿é—´é¢„è®¢
- æˆ‘çš„è®¢å•
- ç»Ÿè®¡æŠ¥è¡¨

---


## ğŸ® å››ã€æ§åˆ¶å™¨å±‚ï¼ˆControllerï¼‰

Controller å±‚å¤„ç† HTTP è¯·æ±‚ï¼Œè°ƒç”¨ Service å±‚ä¸šåŠ¡é€»è¾‘ï¼Œè¿”å›è§†å›¾æˆ– JSON æ•°æ®ã€‚

### 4.1 AdminLoginController.java - ç®¡ç†å‘˜ç™»å½•æ§åˆ¶å™¨

**æ–‡ä»¶è·¯å¾„**: `src/main/java/com/hotel/controller/AdminLoginController.java`

**åŠŸèƒ½è¯´æ˜**: å¤„ç†ç®¡ç†å‘˜ç™»å½•ã€é€€å‡ºã€åå°é¦–é¡µ

**æ ¸å¿ƒæ–¹æ³•è§£æ**:

#### æ–¹æ³•1: æ˜¾ç¤ºç™»å½•é¡µé¢
```java
@GetMapping("/login")
public String login() {
    return "admin/login";  // è¿”å›JSPè§†å›¾è·¯å¾„
}
```
- **è¯·æ±‚è·¯å¾„**: `GET /admin/login`
- **åŠŸèƒ½**: æ˜¾ç¤ºç®¡ç†å‘˜ç™»å½•é¡µé¢
- **è¿”å›**: `views/admin/login.jsp`

#### æ–¹æ³•2: å¤„ç†ç™»å½•è¯·æ±‚
```java
@PostMapping("/doLogin")
@ResponseBody  // è¿”å›JSONæ•°æ®
public Map<String, Object> doLogin(String userName, String password, 
                                   HttpServletRequest request) {
    Map<String, Object> result = new HashMap<>();
    
    try {
        // 1. è°ƒç”¨ServiceéªŒè¯ç”¨æˆ·åå¯†ç 
        User user = userService.login(userName, password);
        
        // 2. éªŒè¯æ˜¯å¦æ˜¯ç®¡ç†å‘˜
        if (user != null && user.getUserType() == 1) {
            // 3. ä¿å­˜åˆ°Session
            HttpSession session = request.getSession();
            session.setAttribute("adminUser", user);
            
            // 4. è¿”å›æˆåŠŸä¿¡æ¯
            String redirectUrl = request.getContextPath() + "/admin/index";
            result.put("success", true);
            result.put("message", "ç™»å½•æˆåŠŸ");
            result.put("redirectUrl", redirectUrl);
        } else {
            result.put("success", false);
            result.put("message", "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼Œæˆ–ä¸æ˜¯ç®¡ç†å‘˜è´¦æˆ·");
        }
    } catch (Exception e) {
        result.put("success", false);
        result.put("message", "ç™»å½•å¤±è´¥ï¼š" + e.getMessage());
        e.printStackTrace();
    }
    
    return result;
}
```
- **è¯·æ±‚è·¯å¾„**: `POST /admin/doLogin`
- **è¯·æ±‚å‚æ•°**: `userName`, `password`
- **åŠŸèƒ½**: éªŒè¯ç®¡ç†å‘˜ç™»å½•
- **è¿”å›**: JSONæ ¼å¼ `{success: true/false, message: "...", redirectUrl: "..."}`
- **ä¸šåŠ¡é€»è¾‘**:
  1. è°ƒç”¨ UserService éªŒè¯ç”¨æˆ·åå’Œå¯†ç 
  2. æ£€æŸ¥ userType æ˜¯å¦ä¸º 1ï¼ˆç®¡ç†å‘˜ï¼‰
  3. ç™»å½•æˆåŠŸåå°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥ Session
  4. è¿”å›è·³è½¬URL

#### æ–¹æ³•3: åå°é¦–é¡µ
```java
@GetMapping("/index")
public String index(Model model, HttpServletRequest request) {
    HttpSession session = request.getSession();
    User adminUser = (User) session.getAttribute("adminUser");
    
    // ä¸´æ—¶è°ƒè¯•ï¼šå¦‚æœæ²¡æœ‰sessionï¼Œåˆ›å»ºæµ‹è¯•ç”¨æˆ·
    if (adminUser == null) {
        adminUser = new User();
        adminUser.setUserId(1L);
        adminUser.setUserName("admin");
        adminUser.setRealName("æµ‹è¯•ç®¡ç†å‘˜");
        adminUser.setUserType(1);
        session.setAttribute("adminUser", adminUser);
    }
    
    model.addAttribute("adminUser", adminUser);
    return "admin/index";
}
```
- **è¯·æ±‚è·¯å¾„**: `GET /admin/index`
- **åŠŸèƒ½**: æ˜¾ç¤ºåå°ç®¡ç†é¦–é¡µ
- **è¿”å›**: `views/admin/index.jsp`
- **ä¸šåŠ¡é€»è¾‘**:
  1. ä» Session è·å–ç®¡ç†å‘˜ä¿¡æ¯
  2. å°†ç®¡ç†å‘˜ä¿¡æ¯ä¼ é€’ç»™è§†å›¾
  3. è§†å›¾ä¸­æ˜¾ç¤ºç®¡ç†å‘˜å§“åã€èœå•ã€ç»Ÿè®¡æ•°æ®

#### æ–¹æ³•4: é€€å‡ºç™»å½•
```java
@GetMapping("/logout")
public String logout(HttpServletRequest request) {
    HttpSession session = request.getSession();
    session.invalidate();  // é”€æ¯Session
    return "redirect:/admin/login";  // é‡å®šå‘åˆ°ç™»å½•é¡µ
}
```
- **è¯·æ±‚è·¯å¾„**: `GET /admin/logout`
- **åŠŸèƒ½**: é€€å‡ºç™»å½•ï¼Œæ¸…é™¤Session
- **è¿”å›**: é‡å®šå‘åˆ°ç™»å½•é¡µ

**å¯¹åº”åŠŸèƒ½**:
- ç®¡ç†å‘˜ç™»å½•
- åå°é¦–é¡µ
- é€€å‡ºç™»å½•

---


### 4.2 RoomCategoryController.java - æˆ¿é—´åˆ†ç±»æ§åˆ¶å™¨

**æ–‡ä»¶è·¯å¾„**: `src/main/java/com/hotel/controller/RoomCategoryController.java`

**åŠŸèƒ½è¯´æ˜**: å¤„ç†æˆ¿é—´åˆ†ç±»çš„å¢åˆ æ”¹æŸ¥å’Œå›¾ç‰‡ä¸Šä¼ 

**æ ¸å¿ƒæ–¹æ³•è§£æ**:

#### æ–¹æ³•1: åˆ†ç±»åˆ—è¡¨
```java
@GetMapping("/list")
public String list(
    @RequestParam(required = false) String categoryName,
    @RequestParam(required = false) Double priceMin,
    @RequestParam(required = false) Double priceMax,
    @RequestParam(defaultValue = "1") int page,
    @RequestParam(defaultValue = "10") int limit,
    Model model) {
    
    // 1. è®¡ç®—åˆ†é¡µåç§»é‡
    int offset = (page - 1) * limit;
    
    // 2. æŸ¥è¯¢åˆ†ç±»åˆ—è¡¨
    List<RoomCategory> categories = roomCategoryService
        .findByConditionsPaged(categoryName, priceMin, priceMax, page, limit);
    
    // 3. æŸ¥è¯¢æ€»æ•°
    int total = roomCategoryService
        .countByConditions(categoryName, priceMin, priceMax);
    
    // 4. ä¼ é€’æ•°æ®åˆ°è§†å›¾
    model.addAttribute("categories", categories);
    model.addAttribute("total", total);
    model.addAttribute("page", page);
    model.addAttribute("limit", limit);
    
    // 5. å›æ˜¾æœç´¢æ¡ä»¶
    model.addAttribute("searchCategoryName", categoryName);
    model.addAttribute("searchPriceMin", priceMin);
    model.addAttribute("searchPriceMax", priceMax);
    
    return "admin/room/category_list";
}
```
- **è¯·æ±‚è·¯å¾„**: `GET /admin/room/category/list`
- **è¯·æ±‚å‚æ•°**: `categoryName`, `priceMin`, `priceMax`, `page`, `limit`
- **åŠŸèƒ½**: æ˜¾ç¤ºåˆ†ç±»åˆ—è¡¨ï¼Œæ”¯æŒæœç´¢å’Œåˆ†é¡µ
- **è¿”å›**: `views/admin/room/category_list.jsp`

#### æ–¹æ³•2: æ˜¾ç¤ºæ–°å¢è¡¨å•
```java
@GetMapping("/add")
public String add(Model model) {
    model.addAttribute("category", new RoomCategory());
    return "admin/room/category_form";
}
```
- **è¯·æ±‚è·¯å¾„**: `GET /admin/room/category/add`
- **åŠŸèƒ½**: æ˜¾ç¤ºæ–°å¢åˆ†ç±»è¡¨å•
- **è¿”å›**: `views/admin/room/category_form.jsp`

#### æ–¹æ³•3: ä¿å­˜åˆ†ç±»
```java
@PostMapping("/save")
@ResponseBody
public Map<String, Object> save(RoomCategory category) {
    Map<String, Object> result = new HashMap<>();
    
    try {
        category.setCreateTime(new Date());
        boolean success = roomCategoryService.save(category);
        
        result.put("success", success);
        result.put("message", success ? "ä¿å­˜æˆåŠŸ" : "ä¿å­˜å¤±è´¥");
    } catch (Exception e) {
        result.put("success", false);
        result.put("message", "ä¿å­˜å¤±è´¥ï¼š" + e.getMessage());
        e.printStackTrace();
    }
    
    return result;
}
```
- **è¯·æ±‚è·¯å¾„**: `POST /admin/room/category/save`
- **è¯·æ±‚å‚æ•°**: RoomCategory å¯¹è±¡ï¼ˆè¡¨å•æ•°æ®ï¼‰
- **åŠŸèƒ½**: ä¿å­˜æ–°åˆ†ç±»
- **è¿”å›**: JSON `{success: true/false, message: "..."}`

#### æ–¹æ³•4: å›¾ç‰‡ä¸Šä¼ 
```java
@PostMapping("/uploadImage")
@ResponseBody
public Object uploadImage(@RequestParam("file") MultipartFile file, 
                         HttpServletRequest request) {
    if (file == null || file.isEmpty()) {
        return Collections.singletonMap("success", false);
    }
    
    try {
        // 1. è·å–ä¸Šä¼ ç›®å½•ï¼ˆä»é…ç½®æ–‡ä»¶è¯»å–ï¼‰
        String imagesDir = uploadBasePath;  // å¦‚: C:/Users/xxx/hotel-uploads
        if (imagesDir == null || imagesDir.trim().isEmpty()) {
            imagesDir = request.getServletContext()
                .getRealPath("/images/categories");
        }
        
        // 2. åˆ›å»ºåˆ†ç±»å›¾ç‰‡ç›®å½•
        File dir = new File(imagesDir, "categories");
        if (!dir.exists()) dir.mkdirs();
        
        // 3. ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å
        String original = file.getOriginalFilename();
        String ext = "";
        if (original != null && original.contains(".")) {
            ext = original.substring(original.lastIndexOf('.'));
        }
        String filename = System.currentTimeMillis() + "_" + 
                         UUID.randomUUID().toString().replaceAll("-", "") + ext;
        
        // 4. ä¿å­˜æ–‡ä»¶
        File target = new File(dir, filename);
        file.transferTo(target);
        
        // 5. è¿”å›è®¿é—®URL
        String contextPath = request.getContextPath();
        String url = contextPath + "/uploads/categories/" + filename;
        
        Map<String, Object> result = new HashMap<>();
        result.put("success", true);
        result.put("url", url);
        result.put("filename", filename);
        return result;
    } catch (Exception e) {
        e.printStackTrace();
        return Collections.singletonMap("success", false);
    }
}
```
- **è¯·æ±‚è·¯å¾„**: `POST /admin/room/category/uploadImage`
- **è¯·æ±‚å‚æ•°**: `file` (MultipartFile)
- **åŠŸèƒ½**: ä¸Šä¼ åˆ†ç±»å°é¢å›¾ç‰‡
- **è¿”å›**: JSON `{success: true, url: "/uploads/categories/xxx.jpg", filename: "xxx.jpg"}`
- **ä¸šåŠ¡é€»è¾‘**:
  1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºç©º
  2. è·å–ä¸Šä¼ ç›®å½•ï¼ˆä¼˜å…ˆä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„è·¯å¾„ï¼‰
  3. åˆ›å»º categories å­ç›®å½•
  4. ç”Ÿæˆå”¯ä¸€æ–‡ä»¶åï¼ˆæ—¶é—´æˆ³ + UUIDï¼‰
  5. ä¿å­˜æ–‡ä»¶åˆ°ç£ç›˜
  6. è¿”å›è®¿é—®URLï¼ˆç”¨äºå‰ç«¯æ˜¾ç¤ºå’Œä¿å­˜åˆ°æ•°æ®åº“ï¼‰

#### æ–¹æ³•5: åˆ é™¤å›¾ç‰‡
```java
@PostMapping("/deleteImage")
@ResponseBody
public Object deleteImage(String imageUrl, HttpServletRequest request) {
    try {
        if (imageUrl != null && imageUrl.contains("/uploads/categories/")) {
            // 1. ä»URLä¸­æå–æ–‡ä»¶å
            String filename = imageUrl.substring(imageUrl.lastIndexOf("/") + 1);
            
            // 2. æ„å»ºæ–‡ä»¶è·¯å¾„
            String imagesDir = uploadBasePath;
            if (imagesDir == null || imagesDir.trim().isEmpty()) {
                imagesDir = request.getServletContext()
                    .getRealPath("/images/categories");
            }
            
            // 3. åˆ é™¤æ–‡ä»¶
            File file = new File(imagesDir, "categories/" + filename);
            if (file.exists()) {
                file.delete();
            }
            
            return Collections.singletonMap("success", true);
        }
        return Collections.singletonMap("success", false);
    } catch (Exception e) {
        e.printStackTrace();
        return Collections.singletonMap("success", false);
    }
}
```
- **è¯·æ±‚è·¯å¾„**: `POST /admin/room/category/deleteImage`
- **è¯·æ±‚å‚æ•°**: `imageUrl`
- **åŠŸèƒ½**: åˆ é™¤å·²ä¸Šä¼ çš„å›¾ç‰‡æ–‡ä»¶
- **è¿”å›**: JSON `{success: true/false}`

**å¯¹åº”åŠŸèƒ½**:
- æˆ¿é—´åˆ†ç±»ç®¡ç†ï¼ˆåˆ—è¡¨ã€æ–°å¢ã€ç¼–è¾‘ã€åˆ é™¤ï¼‰
- åˆ†ç±»å›¾ç‰‡ä¸Šä¼ 

---

### 4.3 OrderController.java - è®¢å•ç®¡ç†æ§åˆ¶å™¨

**æ–‡ä»¶è·¯å¾„**: `src/main/java/com/hotel/controller/OrderController.java`

**åŠŸèƒ½è¯´æ˜**: å¤„ç†è®¢å•çš„æŸ¥è¯¢ã€ç¡®è®¤ã€å…¥ä½ã€å®Œæˆã€å–æ¶ˆç­‰æ“ä½œ

**æ ¸å¿ƒæ–¹æ³•è§£æ**:

#### æ–¹æ³•1: è®¢å•åˆ—è¡¨
```java
@GetMapping("/list")
public String list(
    @RequestParam(required = false) String orderNo,
    @RequestParam(required = false) String guestName,
    @RequestParam(required = false) String phone,
    @RequestParam(required = false) String userName,
    @RequestParam(required = false) Integer orderStatus,
    @RequestParam(defaultValue = "1") int page,
    @RequestParam(defaultValue = "10") int limit,
    Model model) {
    
    // 1. è®¡ç®—åç§»é‡
    int offset = (page - 1) * limit;
    
    // 2. æŸ¥è¯¢è®¢å•åˆ—è¡¨
    List<Order> orders = orderService.findPageByConditions(
        orderNo, guestName, phone, userName, orderStatus, offset, limit);
    
    // 3. æŸ¥è¯¢æ€»æ•°
    int total = orderService.countByConditions(
        orderNo, guestName, phone, userName, orderStatus);
    
    // 4. ä¸ºæ¯ä¸ªè®¢å•æ·»åŠ å…³è”ä¿¡æ¯
    for (Order order : orders) {
        // è·å–ç”¨æˆ·ä¿¡æ¯
        User user = userService.findById(order.getUserId());
        if (user != null) {
            order.setUserName(user.getUserName());
        }
        
        // è·å–æˆ¿é—´ä¿¡æ¯
        RoomInfo room = roomInfoService.findById(order.getRoomId());
        if (room != null) {
            // å°†æˆ¿é—´ä¿¡æ¯å­˜å‚¨åœ¨remarkå­—æ®µä¸­
            order.setRemark(room.getRoomNo() + "-" + room.getBedType());
        }
    }
    
    // 5. ä¼ é€’æ•°æ®åˆ°è§†å›¾
    model.addAttribute("orders", orders);
    model.addAttribute("total", total);
    model.addAttribute("page", page);
    model.addAttribute("limit", limit);
    
    // 6. å›æ˜¾æœç´¢æ¡ä»¶
    model.addAttribute("searchOrderNo", orderNo);
    model.addAttribute("searchGuestName", guestName);
    model.addAttribute("searchPhone", phone);
    model.addAttribute("searchUserName", userName);
    model.addAttribute("searchOrderStatus", orderStatus);
    
    return "admin/order/list";
}
```
- **è¯·æ±‚è·¯å¾„**: `GET /admin/order/list`
- **åŠŸèƒ½**: æ˜¾ç¤ºè®¢å•åˆ—è¡¨ï¼Œæ”¯æŒå¤šæ¡ä»¶æœç´¢å’Œåˆ†é¡µ
- **ä¸šåŠ¡é€»è¾‘**: æŸ¥è¯¢è®¢å•åï¼Œå…³è”æŸ¥è¯¢ç”¨æˆ·å’Œæˆ¿é—´ä¿¡æ¯

#### æ–¹æ³•2: ç¡®è®¤è®¢å•
```java
@PostMapping("/confirm/{orderId}")
@ResponseBody
public Map<String, Object> confirmOrder(@PathVariable Long orderId) {
    Map<String, Object> result = new HashMap<>();
    
    try {
        // 1. æŸ¥è¯¢è®¢å•
        Order order = orderService.findById(orderId);
        if (order == null) {
            result.put("success", false);
            result.put("message", "è®¢å•ä¸å­˜åœ¨");
            return result;
        }
        
        // 2. éªŒè¯è®¢å•çŠ¶æ€
        if (order.getOrderStatus() != 0) {
            result.put("success", false);
            result.put("message", "è®¢å•çŠ¶æ€ä¸å…è®¸ç¡®è®¤");
            return result;
        }
        
        // 3. æ›´æ–°è®¢å•çŠ¶æ€
        order.setOrderStatus(1);  // å·²ç¡®è®¤
        order.setUpdateTime(new Date());
        
        boolean success = orderService.updateSelective(order);
        result.put("success", success);
        result.put("message", success ? "è®¢å•ç¡®è®¤æˆåŠŸ" : "è®¢å•ç¡®è®¤å¤±è´¥");
    } catch (Exception e) {
        result.put("success", false);
        result.put("message", "æ“ä½œå¤±è´¥ï¼š" + e.getMessage());
        e.printStackTrace();
    }
    
    return result;
}
```
- **è¯·æ±‚è·¯å¾„**: `POST /admin/order/confirm/{orderId}`
- **åŠŸèƒ½**: ç¡®è®¤è®¢å•ï¼ˆå¾…ç¡®è®¤ â†’ å·²ç¡®è®¤ï¼‰
- **ä¸šåŠ¡é€»è¾‘**: éªŒè¯è®¢å•çŠ¶æ€åæ›´æ–°ä¸º"å·²ç¡®è®¤"

#### æ–¹æ³•3: ç¡®è®¤å…¥ä½
```java
@PostMapping("/checkin/{orderId}")
@ResponseBody
public Map<String, Object> checkInOrder(@PathVariable Long orderId) {
    Map<String, Object> result = new HashMap<>();
    
    try {
        // 1. æŸ¥è¯¢è®¢å•
        Order order = orderService.findById(orderId);
        if (order == null) {
            result.put("success", false);
            result.put("message", "è®¢å•ä¸å­˜åœ¨");
            return result;
        }
        
        // 2. éªŒè¯è®¢å•çŠ¶æ€
        if (order.getOrderStatus() != 1) {
            result.put("success", false);
            result.put("message", "è®¢å•çŠ¶æ€ä¸å…è®¸å…¥ä½");
            return result;
        }
        
        // 3. æ›´æ–°è®¢å•çŠ¶æ€
        order.setOrderStatus(2);  // å·²å…¥ä½
        order.setUpdateTime(new Date());
        boolean orderSuccess = orderService.updateSelective(order);
        
        // 4. æ›´æ–°æˆ¿é—´çŠ¶æ€ä¸ºå·²å…¥ä½
        RoomInfo room = roomInfoService.findById(order.getRoomId());
        if (room != null) {
            room.setRoomStatus(2);  // å·²å…¥ä½
            room.setUpdateTime(new Date());
            boolean roomSuccess = roomInfoService.update(room);
            
            if (orderSuccess && roomSuccess) {
                result.put("success", true);
                result.put("message", "ç¡®è®¤å…¥ä½æˆåŠŸ");
            } else {
                result.put("success", false);
                result.put("message", "ç¡®è®¤å…¥ä½å¤±è´¥");
            }
        } else {
            result.put("success", false);
            result.put("message", "æˆ¿é—´ä¿¡æ¯ä¸å­˜åœ¨");
        }
    } catch (Exception e) {
        result.put("success", false);
        result.put("message", "æ“ä½œå¤±è´¥ï¼š" + e.getMessage());
        e.printStackTrace();
    }
    
    return result;
}
```
- **è¯·æ±‚è·¯å¾„**: `POST /admin/order/checkin/{orderId}`
- **åŠŸèƒ½**: ç¡®è®¤å…¥ä½ï¼ˆå·²ç¡®è®¤ â†’ å·²å…¥ä½ï¼‰
- **ä¸šåŠ¡é€»è¾‘**: 
  1. æ›´æ–°è®¢å•çŠ¶æ€ä¸º"å·²å…¥ä½"
  2. åŒæ—¶æ›´æ–°æˆ¿é—´çŠ¶æ€ä¸º"å·²å…¥ä½"ï¼ˆä¸å¯é¢„è®¢ï¼‰

#### æ–¹æ³•4: ç¡®è®¤å®Œæˆ
```java
@PostMapping("/complete/{orderId}")
@ResponseBody
public Map<String, Object> completeOrder(@PathVariable Long orderId) {
    // ... ç±»ä¼¼ checkInOrder
    
    // å…³é”®é€»è¾‘ï¼š
    order.setOrderStatus(3);  // å·²å®Œæˆ
    room.setRoomStatus(0);    // å¯é¢„è®¢ï¼ˆé‡Šæ”¾æˆ¿é—´ï¼‰
    
    // ...
}
```
- **è¯·æ±‚è·¯å¾„**: `POST /admin/order/complete/{orderId}`
- **åŠŸèƒ½**: ç¡®è®¤å®Œæˆï¼ˆå·²å…¥ä½ â†’ å·²å®Œæˆï¼‰
- **ä¸šåŠ¡é€»è¾‘**: 
  1. æ›´æ–°è®¢å•çŠ¶æ€ä¸º"å·²å®Œæˆ"
  2. é‡Šæ”¾æˆ¿é—´ï¼ŒçŠ¶æ€æ”¹ä¸º"å¯é¢„è®¢"

**å¯¹åº”åŠŸèƒ½**:
- è®¢å•ç®¡ç†ï¼ˆåˆ—è¡¨ã€è¯¦æƒ…ã€ç¡®è®¤ã€å…¥ä½ã€å®Œæˆã€å–æ¶ˆã€åˆ é™¤ï¼‰
- è®¢å•çŠ¶æ€æµè½¬

---


### 4.4 StatisticsController.java - ç»Ÿè®¡æŠ¥è¡¨æ§åˆ¶å™¨

**æ–‡ä»¶è·¯å¾„**: `src/main/java/com/hotel/controller/StatisticsController.java`

**åŠŸèƒ½è¯´æ˜**: å¤„ç†å…¥ä½ç»Ÿè®¡å’Œæ”¶å…¥ç»Ÿè®¡ï¼Œæä¾›æ•°æ®åˆ†æåŠŸèƒ½

**æ ¸å¿ƒæ–¹æ³•è§£æ**:

#### æ–¹æ³•1: å…¥ä½ç»Ÿè®¡é¡µé¢
```java
@GetMapping("/occupancy")
public String occupancy(Model model) {
    // è·å–æ‰€æœ‰æˆ¿é—´åˆ†ç±»ï¼ˆç”¨äºç­›é€‰ï¼‰
    List<RoomCategory> categories = roomCategoryService.findAll();
    model.addAttribute("categories", categories);
    return "admin/statistics/occupancy";
}
```
- **è¯·æ±‚è·¯å¾„**: `GET /admin/statistics/occupancy`
- **åŠŸèƒ½**: æ˜¾ç¤ºå…¥ä½ç»Ÿè®¡é¡µé¢
- **è¿”å›**: `views/admin/statistics/occupancy.jsp`

#### æ–¹æ³•2: è·å–å…¥ä½ç»Ÿè®¡æ•°æ®
```java
@GetMapping("/occupancy/data")
@ResponseBody
public Map<String, Object> getOccupancyData(String period) {
    Map<String, Object> result = new HashMap<>();
    
    try {
        // 1. è®¾ç½®æ—¶é—´èŒƒå›´
        Calendar cal = Calendar.getInstance();
        Date end = new Date();
        Date start = new Date();
        
        // 2. æ ¹æ®periodè®¾ç½®æ—¶é—´èŒƒå›´
        switch (period != null ? period : "month") {
            case "day":    // å½“å¤©
                cal.set(Calendar.HOUR_OF_DAY, 0);
                cal.set(Calendar.MINUTE, 0);
                cal.set(Calendar.SECOND, 0);
                start = cal.getTime();
                cal.add(Calendar.DAY_OF_MONTH, 1);
                end = cal.getTime();
                break;
            case "week":   // æœ€è¿‘7å¤©
                cal.add(Calendar.DAY_OF_MONTH, -6);
                start = cal.getTime();
                break;
            case "month":  // æœ€è¿‘30å¤©
                cal.add(Calendar.DAY_OF_MONTH, -29);
                start = cal.getTime();
                break;
            case "year":   // æœ€è¿‘365å¤©
                cal.add(Calendar.DAY_OF_MONTH, -364);
                start = cal.getTime();
                break;
        }
        
        // 3. è®¡ç®—ç»Ÿè®¡æ•°æ®
        List<Map<String, Object>> occupancyData = 
            calculateOccupancyData(start, end, period);
        
        result.put("success", true);
        result.put("data", occupancyData);
    } catch (Exception e) {
        result.put("success", false);
        result.put("message", "è·å–æ•°æ®å¤±è´¥ï¼š" + e.getMessage());
        e.printStackTrace();
    }
    
    return result;
}
```
- **è¯·æ±‚è·¯å¾„**: `GET /admin/statistics/occupancy/data`
- **è¯·æ±‚å‚æ•°**: `period` (day/week/month/year)
- **åŠŸèƒ½**: è·å–å…¥ä½ç»Ÿè®¡æ•°æ®ï¼ˆJSONæ ¼å¼ï¼‰
- **è¿”å›**: 
```json
{
  "success": true,
  "data": [
    {
      "categoryName": "è±ªåå¥—æˆ¿",
      "totalRooms": 10,
      "occupancyRate": 75.5,
      "totalRevenue": 15000.00,
      "orderCount": 20
    },
    // ...
  ]
}
```

#### æ–¹æ³•3: è®¡ç®—å…¥ä½ç»Ÿè®¡æ•°æ®ï¼ˆç§æœ‰æ–¹æ³•ï¼‰
```java
private List<Map<String, Object>> calculateOccupancyData(
    Date startDate, Date endDate, String period) {
    
    List<Map<String, Object>> result = new ArrayList<>();
    
    // 1. è·å–æ‰€æœ‰æˆ¿é—´åˆ†ç±»
    List<RoomCategory> categories = roomCategoryService.findAll();
    
    // 2. è·å–æ‰€æœ‰è®¢å•
    List<Order> allOrders = orderService.findAll();
    
    // 3. æŒ‰æˆ¿é—´åˆ†ç±»ç»Ÿè®¡
    for (RoomCategory category : categories) {
        Map<String, Object> categoryData = new HashMap<>();
        categoryData.put("categoryName", category.getCategoryName());
        categoryData.put("categoryId", category.getCategoryId());
        
        // è·å–è¯¥åˆ†ç±»çš„æ‰€æœ‰æˆ¿é—´
        List<RoomInfo> rooms = roomInfoService
            .findByCategoryId(category.getCategoryId());
        int categoryRoomCount = rooms.size();
        
        // è®¡ç®—è¯¥åˆ†ç±»çš„å…¥ä½ç‡
        double categoryOccupancyRate = 
            calculateCategoryOccupancyRate(rooms, allOrders, startDate, endDate);
        
        // ç»Ÿè®¡è¯¥åˆ†ç±»çš„æ”¶å…¥ï¼ˆå·²å®Œæˆè®¢å•ï¼‰
        BigDecimal categoryRevenue = BigDecimal.ZERO;
        int categoryOrderCount = 0;
        
        for (Order order : allOrders) {
            if (order.getCategoryId().equals(category.getCategoryId()) &&
                order.getOrderStatus() == 3 &&  // å·²å®Œæˆ
                !order.getCreateTime().before(startDate) &&
                !order.getCreateTime().after(endDate)) {
                categoryRevenue = categoryRevenue.add(order.getTotalPrice());
                categoryOrderCount++;
            }
        }
        
        categoryData.put("totalRooms", categoryRoomCount);
        categoryData.put("occupancyRate", categoryOccupancyRate);
        categoryData.put("totalRevenue", categoryRevenue);
        categoryData.put("orderCount", categoryOrderCount);
        
        result.add(categoryData);
    }
    
    return result;
}
```
- **åŠŸèƒ½**: è®¡ç®—å„åˆ†ç±»çš„å…¥ä½ç‡ã€æ”¶å…¥ã€è®¢å•æ•°
- **è®¡ç®—é€»è¾‘**:
  - å…¥ä½ç‡ = (å·²å…¥ä½æˆ¿é—´å¤©æ•° / æ€»æˆ¿é—´å¤©æ•°) Ã— 100%
  - åªç»Ÿè®¡"å·²å…¥ä½"å’Œ"å·²å®Œæˆ"çŠ¶æ€çš„è®¢å•
  - è€ƒè™‘è®¢å•æ—¶é—´ä¸ç»Ÿè®¡æ—¶é—´æ®µçš„äº¤é›†

#### æ–¹æ³•4: æ”¶å…¥ç»Ÿè®¡æ•°æ®
```java
@GetMapping("/revenue/data")
@ResponseBody
public Map<String, Object> getRevenueData(String period) {
    // ç±»ä¼¼ getOccupancyData
    // é‡ç‚¹ç»Ÿè®¡æ”¶å…¥é‡‘é¢å’Œè®¢å•æ•°é‡
    // æŒ‰æ—¶é—´æ®µå±•ç¤ºæ”¶å…¥è¶‹åŠ¿
}
```
- **è¯·æ±‚è·¯å¾„**: `GET /admin/statistics/revenue/data`
- **åŠŸèƒ½**: è·å–æ”¶å…¥ç»Ÿè®¡æ•°æ®
- **è¿”å›**: æ”¶å…¥è¶‹åŠ¿ã€åˆ†ç±»æ”¶å…¥å æ¯”ç­‰æ•°æ®

**å¯¹åº”åŠŸèƒ½**:
- å…¥ä½ç»Ÿè®¡ï¼ˆæŒ‰åˆ†ç±»ã€æŒ‰æ—¶é—´æ®µï¼‰
- æ”¶å…¥ç»Ÿè®¡ï¼ˆæŒ‰åˆ†ç±»ã€æŒ‰æ—¶é—´æ®µï¼‰
- æ•°æ®å¯è§†åŒ–ï¼ˆå›¾è¡¨å±•ç¤ºï¼‰

---


### 4.5 UserRoomController.java - ç”¨æˆ·ç«¯æˆ¿é—´æ§åˆ¶å™¨

**æ–‡ä»¶è·¯å¾„**: `src/main/java/com/hotel/controller/UserRoomController.java`

**åŠŸèƒ½è¯´æ˜**: å¤„ç†ç”¨æˆ·ç«¯çš„æˆ¿é—´æµè§ˆã€è¯¦æƒ…ã€é¢„è®¢ã€è®¢å•æŸ¥è¯¢

**æ ¸å¿ƒæ–¹æ³•è§£æ**:

#### æ–¹æ³•1: æˆ¿é—´åˆ—è¡¨
```java
@GetMapping("/rooms")
public String rooms(
    @RequestParam(required = false) String roomNo,
    @RequestParam(required = false) Long categoryId,
    @RequestParam(required = false) BigDecimal priceMin,
    @RequestParam(required = false) BigDecimal priceMax,
    HttpSession session, Model model) {
    
    // 1. éªŒè¯ç”¨æˆ·ç™»å½•
    User user = (User) session.getAttribute("user");
    if (user == null) {
        return "redirect:/user/login";
    }
    
    // 2. æŸ¥è¯¢æˆ¿é—´åˆ—è¡¨
    List<RoomInfo> rooms;
    if (roomNo != null || categoryId != null || 
        priceMin != null || priceMax != null) {
        rooms = roomInfoService.findByConditions(
            roomNo, categoryId, priceMin, priceMax, null);
    } else {
        rooms = roomInfoService.findAll();
    }
    
    // 3. æŸ¥è¯¢æ‰€æœ‰åˆ†ç±»ï¼ˆç”¨äºç­›é€‰ï¼‰
    List<RoomCategory> categories = roomCategoryService.findAll();
    
    // 4. ä¼ é€’æ•°æ®åˆ°è§†å›¾
    model.addAttribute("user", user);
    model.addAttribute("rooms", rooms);
    model.addAttribute("categories", categories);
    model.addAttribute("searchRoomNo", roomNo);
    model.addAttribute("searchCategoryId", categoryId);
    model.addAttribute("searchPriceMin", priceMin);
    model.addAttribute("searchPriceMax", priceMax);
    
    return "user/rooms";
}
```
- **è¯·æ±‚è·¯å¾„**: `GET /user/rooms`
- **åŠŸèƒ½**: æ˜¾ç¤ºæˆ¿é—´åˆ—è¡¨ï¼Œæ”¯æŒç­›é€‰
- **ä¸šåŠ¡é€»è¾‘**: éªŒè¯ç™»å½•åæŸ¥è¯¢æˆ¿é—´ï¼Œæ”¯æŒå¤šæ¡ä»¶ç­›é€‰

#### æ–¹æ³•2: æˆ¿é—´è¯¦æƒ…
```java
@GetMapping("/room/{roomId}")
public String roomDetail(@PathVariable("roomId") Long roomId, 
                        HttpSession session, Model model) {
    // 1. éªŒè¯ç™»å½•
    User user = (User) session.getAttribute("user");
    if (user == null) {
        return "redirect:/user/login";
    }
    
    // 2. æŸ¥è¯¢æˆ¿é—´ä¿¡æ¯
    RoomInfo room = roomInfoService.findById(roomId);
    if (room == null) {
        return "redirect:/user/rooms";
    }
    
    // 3. æŸ¥è¯¢åˆ†ç±»åç§°
    List<RoomCategory> categories = roomCategoryService.findAll();
    String categoryName = "";
    for (RoomCategory category : categories) {
        if (category.getCategoryId().equals(room.getCategoryId())) {
            categoryName = category.getCategoryName();
            break;
        }
    }
    
    // 4. ä¼ é€’æ•°æ®åˆ°è§†å›¾
    model.addAttribute("user", user);
    model.addAttribute("room", room);
    model.addAttribute("categoryName", categoryName);
    
    return "user/room_detail";
}
```
- **è¯·æ±‚è·¯å¾„**: `GET /user/room/{roomId}`
- **åŠŸèƒ½**: æ˜¾ç¤ºæˆ¿é—´è¯¦æƒ…é¡µ
- **ä¸šåŠ¡é€»è¾‘**: æŸ¥è¯¢æˆ¿é—´ä¿¡æ¯å’Œåˆ†ç±»åç§°

#### æ–¹æ³•3: é¢„è®¢é¡µé¢
```java
@GetMapping("/book/{roomId}")
public String bookPage(@PathVariable("roomId") Long roomId, 
                      HttpSession session, Model model) {
    // 1. éªŒè¯ç™»å½•
    User user = (User) session.getAttribute("user");
    if (user == null) {
        return "redirect:/user/login";
    }
    
    // 2. æŸ¥è¯¢æˆ¿é—´ä¿¡æ¯
    RoomInfo room = roomInfoService.findById(roomId);
    if (room == null || room.getRoomStatus() != 0) {
        // æˆ¿é—´ä¸å­˜åœ¨æˆ–ä¸å¯é¢„è®¢
        return "redirect:/user/rooms";
    }
    
    // 3. ä¼ é€’æ•°æ®åˆ°è§†å›¾
    model.addAttribute("user", user);
    model.addAttribute("room", room);
    
    return "user/book";
}
```
- **è¯·æ±‚è·¯å¾„**: `GET /user/book/{roomId}`
- **åŠŸèƒ½**: æ˜¾ç¤ºé¢„è®¢è¡¨å•é¡µé¢
- **ä¸šåŠ¡é€»è¾‘**: éªŒè¯æˆ¿é—´æ˜¯å¦å¯é¢„è®¢

#### æ–¹æ³•4: æäº¤è®¢å•
```java
@PostMapping("/submitOrder")
@ResponseBody
public Map<String, Object> submitOrder(
    @RequestParam Long roomId,
    @RequestParam String guestName,
    @RequestParam String phone,
    @RequestParam String checkInDate,
    @RequestParam String checkOutDate,
    @RequestParam(required = false) String specialRequests,
    HttpSession session) {
    
    Map<String, Object> result = new HashMap<>();
    
    try {
        // 1. éªŒè¯ç™»å½•
        User user = (User) session.getAttribute("user");
        if (user == null) {
            result.put("success", false);
            result.put("message", "è¯·å…ˆç™»å½•");
            return result;
        }
        
        // 2. æŸ¥è¯¢æˆ¿é—´ä¿¡æ¯
        RoomInfo room = roomInfoService.findById(roomId);
        if (room == null || room.getRoomStatus() != 0) {
            result.put("success", false);
            result.put("message", "æˆ¿é—´ä¸å¯é¢„è®¢");
            return result;
        }
        
        // 3. è§£ææ—¥æœŸ
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
        Date checkIn = sdf.parse(checkInDate);
        Date checkOut = sdf.parse(checkOutDate);
        
        // 4. éªŒè¯æ—¥æœŸ
        if (checkOut.before(checkIn)) {
            result.put("success", false);
            result.put("message", "é€€æˆ¿æ—¥æœŸä¸èƒ½æ—©äºå…¥ä½æ—¥æœŸ");
            return result;
        }
        
        // 5. åˆ›å»ºè®¢å•
        Order order = new Order();
        order.setUserId(user.getUserId());
        order.setRoomId(roomId);
        order.setCategoryId(room.getCategoryId());
        order.setGuestName(guestName);
        order.setPhone(phone);
        order.setCheckInDate(checkIn);
        order.setCheckOutDate(checkOut);
        order.setRoomPrice(BigDecimal.valueOf(room.getPrice()));
        order.setSpecialRequests(specialRequests);
        
        // 6. ä¿å­˜è®¢å•ï¼ˆServiceä¼šè‡ªåŠ¨è®¡ç®—å¤©æ•°å’Œæ€»ä»·ï¼‰
        boolean success = orderService.createOrder(order);
        
        if (success) {
            result.put("success", true);
            result.put("message", "é¢„è®¢æˆåŠŸ");
        } else {
            result.put("success", false);
            result.put("message", "é¢„è®¢å¤±è´¥");
        }
    } catch (Exception e) {
        result.put("success", false);
        result.put("message", "é¢„è®¢å¤±è´¥ï¼š" + e.getMessage());
        e.printStackTrace();
    }
    
    return result;
}
```
- **è¯·æ±‚è·¯å¾„**: `POST /user/submitOrder`
- **è¯·æ±‚å‚æ•°**: `roomId`, `guestName`, `phone`, `checkInDate`, `checkOutDate`, `specialRequests`
- **åŠŸèƒ½**: æäº¤é¢„è®¢è®¢å•
- **è¿”å›**: JSON `{success: true/false, message: "..."}`
- **ä¸šåŠ¡é€»è¾‘**:
  1. éªŒè¯ç”¨æˆ·ç™»å½•
  2. éªŒè¯æˆ¿é—´æ˜¯å¦å¯é¢„è®¢
  3. éªŒè¯æ—¥æœŸåˆæ³•æ€§
  4. åˆ›å»ºè®¢å•ï¼ˆServiceè‡ªåŠ¨è®¡ç®—å¤©æ•°å’Œæ€»ä»·ï¼‰
  5. ä¿å­˜åˆ°æ•°æ®åº“

#### æ–¹æ³•5: æˆ‘çš„è®¢å•
```java
@GetMapping("/orders")
public String myOrders(HttpSession session, Model model) {
    // 1. éªŒè¯ç™»å½•
    User user = (User) session.getAttribute("user");
    if (user == null) {
        return "redirect:/user/login";
    }
    
    // 2. æŸ¥è¯¢ç”¨æˆ·çš„æ‰€æœ‰è®¢å•
    List<Order> orders = orderService.findByUserId(user.getUserId());
    
    // 3. ä¸ºæ¯ä¸ªè®¢å•æ·»åŠ æˆ¿é—´ä¿¡æ¯
    for (Order order : orders) {
        RoomInfo room = roomInfoService.findById(order.getRoomId());
        if (room != null) {
            order.setRemark(room.getRoomNo() + "-" + room.getBedType());
        }
    }
    
    // 4. ä¼ é€’æ•°æ®åˆ°è§†å›¾
    model.addAttribute("user", user);
    model.addAttribute("orders", orders);
    
    return "user/orders";
}
```
- **è¯·æ±‚è·¯å¾„**: `GET /user/orders`
- **åŠŸèƒ½**: æ˜¾ç¤ºç”¨æˆ·çš„æ‰€æœ‰è®¢å•
- **ä¸šåŠ¡é€»è¾‘**: æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„è®¢å•ï¼Œå…³è”æˆ¿é—´ä¿¡æ¯

**å¯¹åº”åŠŸèƒ½**:
- æˆ¿é—´æµè§ˆ
- æˆ¿é—´è¯¦æƒ…
- æˆ¿é—´é¢„è®¢
- æˆ‘çš„è®¢å•

---

## âš™ï¸ äº”ã€é…ç½®ç±»ï¼ˆConfigï¼‰

### 5.1 AdminLoginInterceptor.java - ç®¡ç†å‘˜ç™»å½•æ‹¦æˆªå™¨

**æ–‡ä»¶è·¯å¾„**: `src/main/java/com/hotel/config/AdminLoginInterceptor.java`

**åŠŸèƒ½è¯´æ˜**: æ‹¦æˆªç®¡ç†å‘˜åå°è¯·æ±‚ï¼ŒéªŒè¯ç™»å½•çŠ¶æ€

**ä»£ç è§£æ**:
```java
public class AdminLoginInterceptor implements HandlerInterceptor {
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                            HttpServletResponse response, 
                            Object handler) throws Exception {
        
        // 1. è·å–è¯·æ±‚è·¯å¾„
        String requestURI = request.getRequestURI();
        
        // 2. æ”¾è¡Œç™»å½•ç›¸å…³è¯·æ±‚
        if (requestURI.contains("/admin/login") || 
            requestURI.contains("/admin/doLogin")) {
            return true;  // æ”¾è¡Œ
        }
        
        // 3. æ£€æŸ¥Sessionä¸­çš„ç®¡ç†å‘˜ä¿¡æ¯
        HttpSession session = request.getSession();
        User adminUser = (User) session.getAttribute("adminUser");
        
        // 4. éªŒè¯æ˜¯å¦ç™»å½•ä¸”æ˜¯ç®¡ç†å‘˜
        if (adminUser == null || adminUser.getUserType() != 1) {
            // æœªç™»å½•æˆ–ä¸æ˜¯ç®¡ç†å‘˜ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ
            response.sendRedirect(request.getContextPath() + "/admin/login");
            return false;  // æ‹¦æˆª
        }
        
        // 5. éªŒè¯é€šè¿‡ï¼Œæ”¾è¡Œ
        return true;
    }
}
```

**æ‹¦æˆªé€»è¾‘**:
1. è·å–è¯·æ±‚è·¯å¾„
2. å¦‚æœæ˜¯ç™»å½•ç›¸å…³è·¯å¾„ï¼ˆ`/admin/login`, `/admin/doLogin`ï¼‰ï¼Œç›´æ¥æ”¾è¡Œ
3. ä» Session è·å–ç®¡ç†å‘˜ä¿¡æ¯
4. éªŒè¯æ˜¯å¦ç™»å½•ä¸” `userType == 1`ï¼ˆç®¡ç†å‘˜ï¼‰
5. éªŒè¯å¤±è´¥åˆ™é‡å®šå‘åˆ°ç™»å½•é¡µï¼ŒéªŒè¯æˆåŠŸåˆ™æ”¾è¡Œ

**é…ç½®ä½ç½®**: `src/main/resources/spring-mvc.xml`
```xml
<mvc:interceptors>
    <mvc:interceptor>
        <mvc:mapping path="/admin/**"/>
        <bean class="com.hotel.config.AdminLoginInterceptor"/>
    </mvc:interceptor>
</mvc:interceptors>
```

**å¯¹åº”åŠŸèƒ½**: ç®¡ç†å‘˜æƒé™æ§åˆ¶

---

### 5.2 UserLoginInterceptor.java - ç”¨æˆ·ç™»å½•æ‹¦æˆªå™¨

**æ–‡ä»¶è·¯å¾„**: `src/main/java/com/hotel/config/UserLoginInterceptor.java`

**åŠŸèƒ½è¯´æ˜**: æ‹¦æˆªç”¨æˆ·ç«¯è¯·æ±‚ï¼ŒéªŒè¯ç™»å½•çŠ¶æ€

**ä»£ç è§£æ**:
```java
public class UserLoginInterceptor implements HandlerInterceptor {
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                            HttpServletResponse response, 
                            Object handler) throws Exception {
        
        // 1. è·å–è¯·æ±‚è·¯å¾„
        String requestURI = request.getRequestURI();
        
        // 2. æ”¾è¡Œç™»å½•æ³¨å†Œç›¸å…³è¯·æ±‚
        if (requestURI.contains("/user/login") || 
            requestURI.contains("/user/register") ||
            requestURI.contains("/user/doLogin") ||
            requestURI.contains("/user/doRegister")) {
            return true;
        }
        
        // 3. æ£€æŸ¥Sessionä¸­çš„ç”¨æˆ·ä¿¡æ¯
        HttpSession session = request.getSession();
        User user = (User) session.getAttribute("user");
        
        // 4. éªŒè¯æ˜¯å¦ç™»å½•ä¸”æ˜¯æ™®é€šç”¨æˆ·
        if (user == null || user.getUserType() != 0) {
            // æœªç™»å½•æˆ–ä¸æ˜¯æ™®é€šç”¨æˆ·ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ
            response.sendRedirect(request.getContextPath() + "/user/login");
            return false;
        }
        
        // 5. éªŒè¯é€šè¿‡ï¼Œæ”¾è¡Œ
        return true;
    }
}
```

**æ‹¦æˆªé€»è¾‘**: ç±»ä¼¼ç®¡ç†å‘˜æ‹¦æˆªå™¨ï¼Œä½†éªŒè¯ `userType == 0`ï¼ˆæ™®é€šç”¨æˆ·ï¼‰

**é…ç½®ä½ç½®**: `src/main/resources/spring-mvc.xml`
```xml
<mvc:interceptor>
    <mvc:mapping path="/user/**"/>
    <bean class="com.hotel.config.UserLoginInterceptor"/>
</mvc:interceptor>
```

**å¯¹åº”åŠŸèƒ½**: ç”¨æˆ·æƒé™æ§åˆ¶

---


## ğŸ“ å…­ã€é…ç½®æ–‡ä»¶ï¼ˆResourcesï¼‰

### 6.1 web.xml - Webåº”ç”¨é…ç½®

**æ–‡ä»¶è·¯å¾„**: `src/main/webapp/WEB-INF/web.xml`

**åŠŸèƒ½è¯´æ˜**: Webåº”ç”¨çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œé…ç½®Servletã€Filterã€Listenerç­‰

**ä»£ç è§£æ**:

#### 1. æ¬¢è¿é¡µé¢
```xml
<welcome-file-list>
    <welcome-file>index.jsp</welcome-file>
</welcome-file-list>
```
- è®¿é—®æ ¹è·¯å¾„æ—¶é»˜è®¤æ˜¾ç¤ºçš„é¡µé¢

#### 2. ç¼–ç è¿‡æ»¤å™¨
```xml
<filter>
    <filter-name>encodingFilter</filter-name>
    <filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
    <init-param>
        <param-name>encoding</param-name>
        <param-value>UTF-8</param-value>
    </init-param>
    <init-param>
        <param-name>forceEncoding</param-name>
        <param-value>true</param-value>
    </init-param>
</filter>
<filter-mapping>
    <filter-name>encodingFilter</filter-name>
    <url-pattern>/*</url-pattern>
</filter-mapping>
```
- **åŠŸèƒ½**: è®¾ç½®è¯·æ±‚å’Œå“åº”çš„å­—ç¬¦ç¼–ç ä¸º UTF-8
- **ä½œç”¨**: è§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜
- **æ‹¦æˆªè·¯å¾„**: æ‰€æœ‰è¯·æ±‚ `/*`

#### 3. Spring MVC å‰ç«¯æ§åˆ¶å™¨
```xml
<servlet>
    <servlet-name>springMVC</servlet-name>
    <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
    <init-param>
        <param-name>contextConfigLocation</param-name>
        <param-value>classpath:spring-mvc.xml</param-value>
    </init-param>
    <load-on-startup>1</load-on-startup>
</servlet>
<servlet-mapping>
    <servlet-name>springMVC</servlet-name>
    <url-pattern>/</url-pattern>
</servlet-mapping>
```
- **åŠŸèƒ½**: é…ç½® Spring MVC çš„ DispatcherServlet
- **é…ç½®æ–‡ä»¶**: `spring-mvc.xml`
- **æ‹¦æˆªè·¯å¾„**: `/` (æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œé™¤äº† JSP)
- **load-on-startup**: 1 è¡¨ç¤ºå¯åŠ¨æ—¶ç«‹å³åŠ è½½

#### 4. Spring å®¹å™¨ç›‘å¬å™¨
```xml
<listener>
    <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
</listener>
<context-param>
    <param-name>contextConfigLocation</param-name>
    <param-value>classpath:applicationContext.xml</param-value>
</context-param>
```
- **åŠŸèƒ½**: å¯åŠ¨æ—¶åŠ è½½ Spring å®¹å™¨
- **é…ç½®æ–‡ä»¶**: `applicationContext.xml`
- **ä½œç”¨**: åˆå§‹åŒ– Serviceã€DAO ç­‰ Bean

#### 5. Session é…ç½®
```xml
<session-config>
    <session-timeout>30</session-timeout>
</session-config>
```
- **åŠŸèƒ½**: è®¾ç½® Session è¶…æ—¶æ—¶é—´
- **è¶…æ—¶æ—¶é—´**: 30åˆ†é’Ÿ

---

### 6.2 spring-mvc.xml - Spring MVC é…ç½®

**æ–‡ä»¶è·¯å¾„**: `src/main/resources/spring-mvc.xml`

**åŠŸèƒ½è¯´æ˜**: é…ç½® Spring MVC ç›¸å…³ç»„ä»¶

**ä»£ç è§£æ**:

#### 1. åŒ…æ‰«æ
```xml
<context:component-scan base-package="com.hotel.controller"/>
```
- **åŠŸèƒ½**: æ‰«æ Controller åŒ…ï¼Œè‡ªåŠ¨æ³¨å†Œå¸¦ `@Controller` æ³¨è§£çš„ç±»

#### 2. æ³¨è§£é©±åŠ¨
```xml
<mvc:annotation-driven>
    <mvc:message-converters>
        <!-- å­—ç¬¦ä¸²è½¬æ¢å™¨ -->
        <bean class="org.springframework.http.converter.StringHttpMessageConverter">
            <property name="supportedMediaTypes">
                <list>
                    <value>text/html;charset=UTF-8</value>
                    <value>application/json;charset=UTF-8</value>
                </list>
            </property>
        </bean>
        <!-- JSONè½¬æ¢å™¨ -->
        <bean class="org.springframework.http.converter.json.MappingJackson2HttpMessageConverter">
            <property name="supportedMediaTypes">
                <list>
                    <value>application/json;charset=UTF-8</value>
                </list>
            </property>
        </bean>
    </mvc:message-converters>
</mvc:annotation-driven>
```
- **åŠŸèƒ½**: å¯ç”¨ Spring MVC æ³¨è§£æ”¯æŒ
- **æ¶ˆæ¯è½¬æ¢å™¨**: 
  - StringHttpMessageConverter: å¤„ç†å­—ç¬¦ä¸²å“åº”
  - MappingJackson2HttpMessageConverter: å¤„ç† JSON å“åº”ï¼ˆ`@ResponseBody`ï¼‰

#### 3. é™æ€èµ„æºå¤„ç†
```xml
<context:property-placeholder location="classpath:db.properties"/>
<mvc:resources mapping="/static/**" location="/static/"/>
<mvc:resources mapping="/layui/**" location="/static/layui/"/>
<mvc:resources mapping="/uploads/**" location="file:${upload.path}/"/>
<mvc:resources mapping="/images/**" location="/images/"/>
```
- **åŠŸèƒ½**: é…ç½®é™æ€èµ„æºè®¿é—®è·¯å¾„
- **æ˜ å°„è¯´æ˜**:
  - `/static/**` â†’ `/static/` (Layuiæ¡†æ¶)
  - `/layui/**` â†’ `/static/layui/` (Layuiå¿«æ·è®¿é—®)
  - `/uploads/**` â†’ å¤–éƒ¨ç›®å½• `${upload.path}` (ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶)
  - `/images/**` â†’ `/images/` (é¡¹ç›®å†…ç½®å›¾ç‰‡)

#### 4. è§†å›¾è§£æå™¨
```xml
<bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
    <property name="prefix" value="/views/"/>
    <property name="suffix" value=".jsp"/>
</bean>
```
- **åŠŸèƒ½**: é…ç½® JSP è§†å›¾è§£æå™¨
- **å‰ç¼€**: `/views/`
- **åç¼€**: `.jsp`
- **ç¤ºä¾‹**: è¿”å› `"admin/login"` â†’ å®é™…è·¯å¾„ `/views/admin/login.jsp`

#### 5. æ–‡ä»¶ä¸Šä¼ 
```xml
<bean id="multipartResolver" 
      class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
    <property name="defaultEncoding" value="UTF-8"/>
    <property name="maxUploadSize" value="10485760"/>  <!-- 10MB -->
</bean>
```
- **åŠŸèƒ½**: é…ç½®æ–‡ä»¶ä¸Šä¼ è§£æå™¨
- **ç¼–ç **: UTF-8
- **æœ€å¤§æ–‡ä»¶å¤§å°**: 10MB (10485760 å­—èŠ‚)

#### 6. æ‹¦æˆªå™¨é…ç½®
```xml
<mvc:interceptors>
    <!-- ç®¡ç†å‘˜æ‹¦æˆªå™¨ -->
    <mvc:interceptor>
        <mvc:mapping path="/admin/**"/>
        <bean class="com.hotel.config.AdminLoginInterceptor"/>
    </mvc:interceptor>
    <!-- ç”¨æˆ·æ‹¦æˆªå™¨ -->
    <mvc:interceptor>
        <mvc:mapping path="/user/**"/>
        <bean class="com.hotel.config.UserLoginInterceptor"/>
    </mvc:interceptor>
</mvc:interceptors>
```
- **åŠŸèƒ½**: é…ç½®æ‹¦æˆªå™¨
- **ç®¡ç†å‘˜æ‹¦æˆªå™¨**: æ‹¦æˆª `/admin/**` è·¯å¾„
- **ç”¨æˆ·æ‹¦æˆªå™¨**: æ‹¦æˆª `/user/**` è·¯å¾„

---

### 6.3 applicationContext.xml - Spring å®¹å™¨é…ç½®

**æ–‡ä»¶è·¯å¾„**: `src/main/resources/applicationContext.xml`

**åŠŸèƒ½è¯´æ˜**: é…ç½® Spring å®¹å™¨ï¼Œç®¡ç† Serviceã€DAOã€æ•°æ®æºç­‰ Bean

**ä»£ç è§£æ**:

#### 1. åŒ…æ‰«æ
```xml
<context:component-scan base-package="com.hotel.service"/>
```
- **åŠŸèƒ½**: æ‰«æ Service åŒ…ï¼Œè‡ªåŠ¨æ³¨å†Œå¸¦ `@Service` æ³¨è§£çš„ç±»

#### 2. åŠ è½½é…ç½®æ–‡ä»¶
```xml
<context:property-placeholder location="classpath:db.properties"/>
```
- **åŠŸèƒ½**: åŠ è½½æ•°æ®åº“é…ç½®æ–‡ä»¶
- **æ–‡ä»¶**: `db.properties`

#### 3. æ•°æ®æºé…ç½®
```xml
<bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource">
    <property name="driverClassName" value="${jdbc.driver}"/>
    <property name="url" value="${jdbc.url}"/>
    <property name="username" value="${jdbc.username}"/>
    <property name="password" value="${jdbc.password}"/>
    <property name="initialSize" value="5"/>
    <property name="minIdle" value="5"/>
    <property name="maxActive" value="20"/>
    <property name="maxWait" value="60000"/>
</bean>
```
- **åŠŸèƒ½**: é…ç½® Druid æ•°æ®åº“è¿æ¥æ± 
- **å‚æ•°è¯´æ˜**:
  - `initialSize`: åˆå§‹è¿æ¥æ•° 5
  - `minIdle`: æœ€å°ç©ºé—²è¿æ¥æ•° 5
  - `maxActive`: æœ€å¤§æ´»åŠ¨è¿æ¥æ•° 20
  - `maxWait`: æœ€å¤§ç­‰å¾…æ—¶é—´ 60ç§’

#### 4. SqlSessionFactory é…ç½®
```xml
<bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
    <property name="dataSource" ref="dataSource"/>
    <property name="configLocation" value="classpath:mybatis-config.xml"/>
    <property name="mapperLocations" value="classpath:mapper/*.xml"/>
</bean>
```
- **åŠŸèƒ½**: é…ç½® MyBatis çš„ SqlSessionFactory
- **æ•°æ®æº**: å¼•ç”¨ä¸Šé¢çš„ dataSource
- **MyBatisé…ç½®**: `mybatis-config.xml`
- **Mapperæ–‡ä»¶**: `mapper/*.xml`

#### 5. Mapper æ‰«æ
```xml
<bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">
    <property name="basePackage" value="com.hotel.dao"/>
    <property name="sqlSessionFactoryBeanName" value="sqlSessionFactory"/>
</bean>
```
- **åŠŸèƒ½**: æ‰«æ DAO æ¥å£ï¼Œè‡ªåŠ¨ç”Ÿæˆå®ç°ç±»
- **æ‰«æåŒ…**: `com.hotel.dao`

#### 6. äº‹åŠ¡ç®¡ç†å™¨
```xml
<bean id="transactionManager" 
      class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
    <property name="dataSource" ref="dataSource"/>
</bean>

<tx:annotation-driven transaction-manager="transactionManager"/>
```
- **åŠŸèƒ½**: é…ç½®äº‹åŠ¡ç®¡ç†å™¨
- **æ³¨è§£é©±åŠ¨**: æ”¯æŒ `@Transactional` æ³¨è§£

---

### 6.4 mybatis-config.xml - MyBatis é…ç½®

**æ–‡ä»¶è·¯å¾„**: `src/main/resources/mybatis-config.xml`

**åŠŸèƒ½è¯´æ˜**: é…ç½® MyBatis å…¨å±€è®¾ç½®

**ä»£ç è§£æ**:
```xml
<configuration>
    <settings>
        <!-- å¼€å¯é©¼å³°å‘½åè‡ªåŠ¨æ˜ å°„ -->
        <setting name="mapUnderscoreToCamelCase" value="true"/>
        <!-- å¼€å¯å»¶è¿ŸåŠ è½½ -->
        <setting name="lazyLoadingEnabled" value="true"/>
        <!-- å¼€å¯äºŒçº§ç¼“å­˜ -->
        <setting name="cacheEnabled" value="true"/>
        <!-- æ—¥å¿—å®ç° -->
        <setting name="logImpl" value="SLF4J"/>
    </settings>
    
    <typeAliases>
        <!-- å®ä½“ç±»åˆ«å -->
        <package name="com.hotel.entity"/>
    </typeAliases>
</configuration>
```

**é…ç½®è¯´æ˜**:
- `mapUnderscoreToCamelCase`: æ•°æ®åº“å­—æ®µ `user_name` è‡ªåŠ¨æ˜ å°„åˆ° `userName`
- `lazyLoadingEnabled`: å»¶è¿ŸåŠ è½½ï¼Œæé«˜æ€§èƒ½
- `cacheEnabled`: å¼€å¯äºŒçº§ç¼“å­˜
- `logImpl`: ä½¿ç”¨ SLF4J æ—¥å¿—
- `typeAliases`: å®ä½“ç±»åˆ«åï¼ŒMapper ä¸­å¯ç›´æ¥ä½¿ç”¨ç±»å

---

### 6.5 db.properties - æ•°æ®åº“é…ç½®

**æ–‡ä»¶è·¯å¾„**: `src/main/resources/db.properties`

**åŠŸèƒ½è¯´æ˜**: æ•°æ®åº“è¿æ¥é…ç½®å’Œä¸Šä¼ è·¯å¾„é…ç½®

**ä»£ç è§£æ**:
```properties
# æ•°æ®åº“é©±åŠ¨
jdbc.driver=com.mysql.cj.jdbc.Driver

# æ•°æ®åº“è¿æ¥URL
jdbc.url=jdbc:mysql://localhost:3306/ssmhotel?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&useSSL=false

# æ•°æ®åº“ç”¨æˆ·å
jdbc.username=root

# æ•°æ®åº“å¯†ç 
jdbc.password=123456

# æ–‡ä»¶ä¸Šä¼ è·¯å¾„ï¼ˆä½¿ç”¨ç”¨æˆ·å®¶ç›®å½•ï¼‰
upload.path=${user.home}/hotel-uploads
```

**é…ç½®è¯´æ˜**:
- `jdbc.driver`: MySQL 8.0 é©±åŠ¨ç±»
- `jdbc.url`: 
  - `useUnicode=true&characterEncoding=UTF-8`: æ”¯æŒä¸­æ–‡
  - `serverTimezone=Asia/Shanghai`: è®¾ç½®æ—¶åŒº
  - `useSSL=false`: å…³é—­ SSLï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- `upload.path`: 
  - `${user.home}`: ç”¨æˆ·å®¶ç›®å½•
  - Windows: `C:\Users\ç”¨æˆ·å\hotel-uploads`
  - Linux: `/home/ç”¨æˆ·å/hotel-uploads`

---

### 6.6 logback.xml - æ—¥å¿—é…ç½®

**æ–‡ä»¶è·¯å¾„**: `src/main/resources/logback.xml`

**åŠŸèƒ½è¯´æ˜**: é…ç½®æ—¥å¿—è¾“å‡ºæ ¼å¼å’Œçº§åˆ«

**ä»£ç è§£æ**:

#### 1. æ§åˆ¶å°è¾“å‡º
```xml
<appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
    <encoder>
        <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
        <charset>UTF-8</charset>
    </encoder>
</appender>
```
- **åŠŸèƒ½**: æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°
- **æ ¼å¼**: `æ—¶é—´ [çº¿ç¨‹] çº§åˆ« ç±»å - æ¶ˆæ¯`
- **ç¤ºä¾‹**: `2026-01-17 10:30:45.123 [http-nio-8080-exec-1] INFO  c.h.controller.AdminLoginController - ç™»å½•æˆåŠŸ`

#### 2. æ–‡ä»¶è¾“å‡º
```xml
<appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
    <file>logs/hotel.log</file>
    <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
        <fileNamePattern>logs/hotel.%d{yyyy-MM-dd}.%i.log</fileNamePattern>
        <maxHistory>30</maxHistory>
        <timeBasedFileNamingAndTriggeringPolicy 
            class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
            <maxFileSize>10MB</maxFileSize>
        </timeBasedFileNamingAndTriggeringPolicy>
    </rollingPolicy>
    <encoder>
        <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
        <charset>UTF-8</charset>
    </encoder>
</appender>
```
- **åŠŸèƒ½**: æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶
- **æ–‡ä»¶ä½ç½®**: `logs/hotel.log`
- **æ»šåŠ¨ç­–ç•¥**: 
  - æŒ‰æ—¥æœŸæ»šåŠ¨: `hotel.2026-01-17.0.log`
  - å•æ–‡ä»¶æœ€å¤§ 10MB
  - ä¿ç•™ 30 å¤©

#### 3. æ—¥å¿—çº§åˆ«
```xml
<root level="INFO">
    <appender-ref ref="CONSOLE"/>
    <appender-ref ref="FILE"/>
</root>

<logger name="com.hotel" level="DEBUG"/>
```
- **å…¨å±€çº§åˆ«**: INFO
- **é¡¹ç›®çº§åˆ«**: DEBUGï¼ˆcom.hotel åŒ…ï¼‰
- **è¾“å‡ºä½ç½®**: æ§åˆ¶å° + æ–‡ä»¶

---


## ğŸ—ºï¸ ä¸ƒã€MyBatis Mapper æ–‡ä»¶

Mapper æ–‡ä»¶å®šä¹‰ SQL è¯­å¥ï¼Œå®ç° DAO æ¥å£çš„æ–¹æ³•ã€‚

### 7.1 UserDao.xml - ç”¨æˆ· Mapper

**æ–‡ä»¶è·¯å¾„**: `src/main/resources/mapper/UserDao.xml`

**åŠŸèƒ½è¯´æ˜**: å®šä¹‰ç”¨æˆ·è¡¨çš„ SQL æ“ä½œ

**æ ¸å¿ƒ SQL è§£æ**:

#### 1. ResultMap å®šä¹‰
```xml
<resultMap id="BaseResultMap" type="User">
    <id column="user_id" property="userId"/>
    <result column="user_name" property="userName"/>
    <result column="password" property="password"/>
    <result column="real_name" property="realName"/>
    <result column="phone" property="phone"/>
    <result column="email" property="email"/>
    <result column="avatar" property="avatar"/>
    <result column="user_type" property="userType"/>
    <result column="status" property="status"/>
    <result column="create_time" property="createTime"/>
    <result column="update_time" property="updateTime"/>
    <result column="remark" property="remark"/>
</resultMap>
```
- **åŠŸèƒ½**: å®šä¹‰æ•°æ®åº“å­—æ®µä¸å®ä½“ç±»å±æ€§çš„æ˜ å°„å…³ç³»
- **ä½œç”¨**: è‡ªåŠ¨å°†æŸ¥è¯¢ç»“æœæ˜ å°„åˆ° User å¯¹è±¡

#### 2. æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢
```xml
<select id="findByUserName" resultMap="BaseResultMap">
    SELECT * FROM user WHERE user_name = #{userName}
</select>
```
- **åŠŸèƒ½**: æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ï¼ˆç”¨äºç™»å½•ï¼‰
- **å‚æ•°**: `userName`
- **è¿”å›**: User å¯¹è±¡

#### 3. æ¡ä»¶æŸ¥è¯¢ï¼ˆåˆ†é¡µï¼‰
```xml
<select id="findByConditionsPaged" resultMap="BaseResultMap">
    SELECT * FROM user
    <where>
        <if test="userName != null and userName != ''">
            AND user_name LIKE CONCAT('%', #{userName}, '%')
        </if>
        <if test="realName != null and realName != ''">
            AND real_name LIKE CONCAT('%', #{realName}, '%')
        </if>
        <if test="phone != null and phone != ''">
            AND phone LIKE CONCAT('%', #{phone}, '%')
        </if>
        <if test="status != null">
            AND status = #{status}
        </if>
        <if test="userType != null">
            AND user_type = #{userType}
        </if>
    </where>
    ORDER BY create_time DESC
    LIMIT #{offset}, #{limit}
</select>
```
- **åŠŸèƒ½**: å¤šæ¡ä»¶ç»„åˆæŸ¥è¯¢ï¼Œæ”¯æŒåˆ†é¡µ
- **åŠ¨æ€ SQL**: ä½¿ç”¨ `<if>` æ ‡ç­¾ï¼Œåªæ‹¼æ¥éç©ºæ¡ä»¶
- **æ¨¡ç³ŠæŸ¥è¯¢**: ä½¿ç”¨ `LIKE CONCAT('%', #{userName}, '%')`
- **åˆ†é¡µ**: `LIMIT #{offset}, #{limit}`

#### 4. æ’å…¥ç”¨æˆ·
```xml
<insert id="insert" useGeneratedKeys="true" keyProperty="userId">
    INSERT INTO user (
        user_name, password, real_name, phone, email, 
        avatar, user_type, status, create_time, update_time, remark
    ) VALUES (
        #{userName}, #{password}, #{realName}, #{phone}, #{email},
        #{avatar}, #{userType}, #{status}, #{createTime}, #{updateTime}, #{remark}
    )
</insert>
```
- **åŠŸèƒ½**: æ’å…¥æ–°ç”¨æˆ·
- **useGeneratedKeys**: è‡ªåŠ¨è·å–ä¸»é”®
- **keyProperty**: å°†ç”Ÿæˆçš„ä¸»é”®èµ‹å€¼ç»™ `userId` å±æ€§

#### 5. é€‰æ‹©æ€§æ›´æ–°
```xml
<update id="updateSelective">
    UPDATE user
    <set>
        <if test="userName != null">user_name = #{userName},</if>
        <if test="password != null">password = #{password},</if>
        <if test="realName != null">real_name = #{realName},</if>
        <if test="phone != null">phone = #{phone},</if>
        <if test="email != null">email = #{email},</if>
        <if test="avatar != null">avatar = #{avatar},</if>
        <if test="status != null">status = #{status},</if>
        <if test="updateTime != null">update_time = #{updateTime},</if>
        <if test="remark != null">remark = #{remark},</if>
    </set>
    WHERE user_id = #{userId}
</update>
```
- **åŠŸèƒ½**: åªæ›´æ–°éç©ºå­—æ®µ
- **åŠ¨æ€ SQL**: ä½¿ç”¨ `<set>` å’Œ `<if>` æ ‡ç­¾
- **ä¼˜ç‚¹**: é¿å…è¦†ç›–å…¶ä»–å­—æ®µçš„å€¼

---

### 7.2 OrderDao.xml - è®¢å• Mapper

**æ–‡ä»¶è·¯å¾„**: `src/main/resources/mapper/OrderDao.xml`

**æ ¸å¿ƒ SQL è§£æ**:

#### 1. æ¡ä»¶æŸ¥è¯¢ï¼ˆå…³è”ç”¨æˆ·è¡¨ï¼‰
```xml
<select id="findPageByConditions" resultMap="BaseResultMap">
    SELECT o.*, u.user_name
    FROM orders o
    LEFT JOIN user u ON o.user_id = u.user_id
    <where>
        <if test="orderNo != null and orderNo != ''">
            AND o.order_no LIKE CONCAT('%', #{orderNo}, '%')
        </if>
        <if test="guestName != null and guestName != ''">
            AND o.guest_name LIKE CONCAT('%', #{guestName}, '%')
        </if>
        <if test="phone != null and phone != ''">
            AND o.phone LIKE CONCAT('%', #{phone}, '%')
        </if>
        <if test="userName != null and userName != ''">
            AND u.user_name LIKE CONCAT('%', #{userName}, '%')
        </if>
        <if test="orderStatus != null">
            AND o.order_status = #{orderStatus}
        </if>
    </where>
    ORDER BY o.create_time DESC
    LIMIT #{offset}, #{limit}
</select>
```
- **åŠŸèƒ½**: æŸ¥è¯¢è®¢å•ï¼Œå…³è”ç”¨æˆ·è¡¨è·å–ç”¨æˆ·å
- **LEFT JOIN**: å…³è” user è¡¨
- **å¤šæ¡ä»¶**: æ”¯æŒè®¢å•å·ã€å…¥ä½äººã€ç”µè¯ã€ç”¨æˆ·åã€çŠ¶æ€ç­›é€‰

#### 2. æ’å…¥è®¢å•
```xml
<insert id="insert" useGeneratedKeys="true" keyProperty="orderId">
    INSERT INTO orders (
        order_no, user_id, room_id, category_id, guest_name, phone,
        check_in_date, check_out_date, stay_days, room_price, total_price,
        order_status, special_requests, create_time, update_time
    ) VALUES (
        #{orderNo}, #{userId}, #{roomId}, #{categoryId}, #{guestName}, #{phone},
        #{checkInDate}, #{checkOutDate}, #{stayDays}, #{roomPrice}, #{totalPrice},
        #{orderStatus}, #{specialRequests}, #{createTime}, #{updateTime}
    )
</insert>
```
- **åŠŸèƒ½**: æ’å…¥æ–°è®¢å•
- **è‡ªåŠ¨ä¸»é”®**: æ’å…¥åè‡ªåŠ¨è·å– orderId

---

### 7.3 RoomInfoDao.xml - æˆ¿é—´ä¿¡æ¯ Mapper

**æ ¸å¿ƒ SQL è§£æ**:

#### 1. æ¡ä»¶æŸ¥è¯¢
```xml
<select id="findByConditions" resultMap="BaseResultMap">
    SELECT * FROM room_info
    <where>
        <if test="roomNo != null and roomNo != ''">
            AND room_no LIKE CONCAT('%', #{roomNo}, '%')
        </if>
        <if test="categoryId != null">
            AND category_id = #{categoryId}
        </if>
        <if test="priceMin != null">
            AND price >= #{priceMin}
        </if>
        <if test="priceMax != null">
            AND price &lt;= #{priceMax}
        </if>
        <if test="roomStatus != null">
            AND room_status = #{roomStatus}
        </if>
    </where>
    ORDER BY room_no ASC
</select>
```
- **åŠŸèƒ½**: å¤šæ¡ä»¶æŸ¥è¯¢æˆ¿é—´
- **ä»·æ ¼åŒºé—´**: `price >= #{priceMin} AND price <= #{priceMax}`
- **æ³¨æ„**: XML ä¸­ `<=` è¦å†™æˆ `&lt;=`

---

## ğŸ“Š å…«ã€åŠŸèƒ½ä¸ä»£ç å¯¹åº”å…³ç³»

### 8.1 ç®¡ç†å‘˜åå°åŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | Controller | Service | DAO | Mapper | JSPè§†å›¾ |
|---------|-----------|---------|-----|--------|---------|
| **ç®¡ç†å‘˜ç™»å½•** | AdminLoginController | UserService | UserDao | UserDao.xml | admin/login.jsp |
| **åå°é¦–é¡µ** | AdminLoginController | - | - | - | admin/index.jsp |
| **æˆ¿é—´åˆ†ç±»ç®¡ç†** | RoomCategoryController | RoomCategoryService | RoomCategoryDao | RoomCategoryDao.xml | admin/room/category_*.jsp |
| **æˆ¿é—´ä¿¡æ¯ç®¡ç†** | RoomInfoController | RoomInfoService | RoomInfoDao | RoomInfoDao.xml | admin/room/*.jsp |
| **è®¢å•ç®¡ç†** | OrderController | OrderService | OrderDao | OrderDao.xml | admin/order/*.jsp |
| **å…¥ä½ç»Ÿè®¡** | StatisticsController | OrderService, RoomInfoService | OrderDao, RoomInfoDao | *.xml | admin/statistics/occupancy.jsp |
| **æ”¶å…¥ç»Ÿè®¡** | StatisticsController | OrderService | OrderDao | OrderDao.xml | admin/statistics/revenue.jsp |
| **ä¼šå‘˜ç®¡ç†** | UserController | UserService | UserDao | UserDao.xml | admin/user/*.jsp |
| **ç®¡ç†å‘˜ç®¡ç†** | AdminUserController | UserService | UserDao | UserDao.xml | admin/system/*.jsp |
| **ä¸ªäººä¸­å¿ƒ** | ProfileController | UserService | UserDao | UserDao.xml | admin/profile*.jsp |

### 8.2 ç”¨æˆ·å‰å°åŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | Controller | Service | DAO | Mapper | JSPè§†å›¾ |
|---------|-----------|---------|-----|--------|---------|
| **ç”¨æˆ·ç™»å½•/æ³¨å†Œ** | UserLoginController | UserService | UserDao | UserDao.xml | user/login.jsp, user/register.jsp |
| **ç”¨æˆ·é¦–é¡µ** | UserRoomController | - | - | - | user/index.jsp |
| **æˆ¿é—´æµè§ˆ** | UserRoomController | RoomInfoService, RoomCategoryService | RoomInfoDao, RoomCategoryDao | *.xml | user/rooms.jsp |
| **æˆ¿é—´è¯¦æƒ…** | UserRoomController | RoomInfoService, RoomCategoryService | RoomInfoDao, RoomCategoryDao | *.xml | user/room_detail.jsp |
| **æˆ¿é—´é¢„è®¢** | UserRoomController | OrderService, RoomInfoService | OrderDao, RoomInfoDao | *.xml | user/book.jsp |
| **æˆ‘çš„è®¢å•** | UserRoomController | OrderService, RoomInfoService | OrderDao, RoomInfoDao | *.xml | user/orders.jsp |

### 8.3 æ ¸å¿ƒä¸šåŠ¡æµç¨‹

#### æµç¨‹1: ç”¨æˆ·ç™»å½•
```
ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå¯†ç 
    â†“
UserLoginController.doLogin()
    â†“
UserService.login()
    â†“
UserDao.findByUserName()
    â†“
UserDao.xml (SELECT * FROM user WHERE user_name = ?)
    â†“
éªŒè¯å¯†ç å’ŒçŠ¶æ€
    â†“
ä¿å­˜åˆ° Session
    â†“
è¿”å›ç™»å½•æˆåŠŸ
```

#### æµç¨‹2: æˆ¿é—´é¢„è®¢
```
ç”¨æˆ·é€‰æ‹©æˆ¿é—´ï¼Œå¡«å†™é¢„è®¢ä¿¡æ¯
    â†“
UserRoomController.submitOrder()
    â†“
éªŒè¯æˆ¿é—´æ˜¯å¦å¯é¢„è®¢
    â†“
OrderService.createOrder()
    â†“
è®¡ç®—å…¥ä½å¤©æ•°å’Œæ€»ä»·
    â†“
OrderDao.insert()
    â†“
OrderDao.xml (INSERT INTO orders ...)
    â†“
è¿”å›é¢„è®¢æˆåŠŸ
```

#### æµç¨‹3: è®¢å•ç¡®è®¤å…¥ä½
```
ç®¡ç†å‘˜ç‚¹å‡»"ç¡®è®¤å…¥ä½"
    â†“
OrderController.checkInOrder()
    â†“
éªŒè¯è®¢å•çŠ¶æ€
    â†“
OrderService.updateSelective() (è®¢å•çŠ¶æ€ â†’ å·²å…¥ä½)
    â†“
RoomInfoService.update() (æˆ¿é—´çŠ¶æ€ â†’ å·²å…¥ä½)
    â†“
OrderDao.xml, RoomInfoDao.xml (UPDATE ...)
    â†“
è¿”å›æ“ä½œæˆåŠŸ
```

#### æµç¨‹4: å›¾ç‰‡ä¸Šä¼ 
```
ç”¨æˆ·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶
    â†“
RoomCategoryController.uploadImage()
    â†“
æ¥æ”¶ MultipartFile
    â†“
ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å (æ—¶é—´æˆ³ + UUID)
    â†“
ä¿å­˜åˆ°ç£ç›˜ (C:/Users/xxx/hotel-uploads/categories/)
    â†“
è¿”å›è®¿é—® URL (/uploads/categories/xxx.jpg)
    â†“
å‰ç«¯æ˜¾ç¤ºå›¾ç‰‡é¢„è§ˆ
    â†“
ä¿å­˜åˆ†ç±»æ—¶å°† URL å­˜å…¥æ•°æ®åº“
```

---

## ğŸ¯ ä¹ã€ä»£ç è®¾è®¡æ¨¡å¼

### 9.1 MVC æ¨¡å¼
- **Model**: Entity å®ä½“ç±»
- **View**: JSP è§†å›¾
- **Controller**: Controller æ§åˆ¶å™¨

### 9.2 ä¸‰å±‚æ¶æ„
- **è¡¨ç°å±‚**: Controllerï¼ˆå¤„ç†è¯·æ±‚ï¼‰
- **ä¸šåŠ¡å±‚**: Serviceï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
- **æŒä¹…å±‚**: DAO + MyBatisï¼ˆæ•°æ®è®¿é—®ï¼‰

### 9.3 ä¾èµ–æ³¨å…¥
```java
@Controller
public class OrderController {
    @Autowired  // è‡ªåŠ¨æ³¨å…¥
    private OrderService orderService;
}
```

### 9.4 æ‹¦æˆªå™¨æ¨¡å¼
```java
public class AdminLoginInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(...) {
        // åœ¨è¯·æ±‚å¤„ç†å‰æ‰§è¡Œ
    }
}
```

### 9.5 å•ä¾‹æ¨¡å¼
- Spring å®¹å™¨ä¸­çš„ Bean é»˜è®¤æ˜¯å•ä¾‹
- Serviceã€DAO éƒ½æ˜¯å•ä¾‹

---

## ğŸ“ åã€ä»£ç è§„èŒƒä¸æœ€ä½³å®è·µ

### 10.1 å‘½åè§„èŒƒ
- **ç±»å**: å¤§é©¼å³° `UserService`
- **æ–¹æ³•å**: å°é©¼å³° `findById()`
- **å¸¸é‡**: å…¨å¤§å†™ `MAX_SIZE`
- **åŒ…å**: å…¨å°å†™ `com.hotel.service`

### 10.2 æ³¨é‡Šè§„èŒƒ
```java
/**
 * æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·
 * @param userId ç”¨æˆ·ID
 * @return Userå¯¹è±¡ï¼Œä¸å­˜åœ¨è¿”å›null
 */
User findById(Long userId);
```

### 10.3 å¼‚å¸¸å¤„ç†
```java
try {
    // ä¸šåŠ¡é€»è¾‘
} catch (Exception e) {
    result.put("success", false);
    result.put("message", "æ“ä½œå¤±è´¥ï¼š" + e.getMessage());
    e.printStackTrace();  // æ‰“å°å †æ ˆä¿¡æ¯
}
```

### 10.4 æ—¥å¿—è®°å½•
```java
System.out.println("ç™»å½•æˆåŠŸï¼Œç”¨æˆ·: " + userName);
// ç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨æ—¥å¿—æ¡†æ¶
logger.info("ç™»å½•æˆåŠŸï¼Œç”¨æˆ·: {}", userName);
```

### 10.5 SQL æ³¨å…¥é˜²æŠ¤
```xml
<!-- æ­£ç¡®ï¼šä½¿ç”¨ #{} å‚æ•°åŒ–æŸ¥è¯¢ -->
<select id="findByUserName">
    SELECT * FROM user WHERE user_name = #{userName}
</select>

<!-- é”™è¯¯ï¼šä½¿ç”¨ ${} å­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆæœ‰SQLæ³¨å…¥é£é™©ï¼‰ -->
<select id="findByUserName">
    SELECT * FROM user WHERE user_name = '${userName}'
</select>
```

---

## ğŸ“ åä¸€ã€å­¦ä¹ å»ºè®®

### 11.1 å­¦ä¹ è·¯å¾„
1. **ç†è§£é¡¹ç›®ç»“æ„**: å…ˆäº†è§£æ•´ä½“æ¶æ„
2. **é˜…è¯»å®ä½“ç±»**: ç†è§£æ•°æ®æ¨¡å‹
3. **å­¦ä¹  DAO å±‚**: æŒæ¡æ•°æ®è®¿é—®
4. **ç ”ç©¶ Service å±‚**: ç†è§£ä¸šåŠ¡é€»è¾‘
5. **åˆ†æ Controller å±‚**: å­¦ä¹ è¯·æ±‚å¤„ç†
6. **æŸ¥çœ‹é…ç½®æ–‡ä»¶**: ç†è§£æ¡†æ¶é…ç½®
7. **è°ƒè¯•è¿è¡Œ**: å®é™…è¿è¡Œé¡¹ç›®ï¼Œæ‰“æ–­ç‚¹è°ƒè¯•

### 11.2 è°ƒè¯•æŠ€å·§
1. **åœ¨ Controller æ–¹æ³•å…¥å£æ‰“æ–­ç‚¹**: æŸ¥çœ‹è¯·æ±‚å‚æ•°
2. **åœ¨ Service æ–¹æ³•æ‰“æ–­ç‚¹**: æŸ¥çœ‹ä¸šåŠ¡é€»è¾‘æ‰§è¡Œ
3. **åœ¨ DAO æ–¹æ³•æ‰“æ–­ç‚¹**: æŸ¥çœ‹ SQL æ‰§è¡Œ
4. **æŸ¥çœ‹æ—¥å¿—**: `logs/hotel.log`
5. **ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·**: æŸ¥çœ‹ç½‘ç»œè¯·æ±‚å’Œå“åº”

### 11.3 æ‰©å±•ç»ƒä¹ 
1. **æ·»åŠ æ–°åŠŸèƒ½**: å¦‚æˆ¿é—´è¯„ä»·ã€ä¼˜æƒ åˆ¸
2. **ä¼˜åŒ–æ€§èƒ½**: æ·»åŠ ç¼“å­˜ã€ä¼˜åŒ– SQL
3. **å¢å¼ºå®‰å…¨**: å¯†ç åŠ å¯†ã€éªŒè¯ç 
4. **æ”¹è¿›ç•Œé¢**: ä½¿ç”¨ Vue.js é‡æ„å‰ç«¯
5. **æ·»åŠ æµ‹è¯•**: ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

---

## âœ¨ æ€»ç»“

æœ¬æ–‡æ¡£è¯¦ç»†è§£æäº†é…’åº—ç®¡ç†ç³»ç»Ÿçš„æ¯ä¸ªä»£ç æ–‡ä»¶ï¼ŒåŒ…æ‹¬ï¼š

âœ… **å®ä½“ç±»**: 4ä¸ªæ ¸å¿ƒå®ä½“ï¼Œå¯¹åº”æ•°æ®åº“è¡¨  
âœ… **DAO å±‚**: å®šä¹‰æ•°æ®è®¿é—®æ¥å£  
âœ… **Service å±‚**: å°è£…ä¸šåŠ¡é€»è¾‘  
âœ… **Controller å±‚**: å¤„ç† HTTP è¯·æ±‚  
âœ… **é…ç½®ç±»**: æ‹¦æˆªå™¨å®ç°æƒé™æ§åˆ¶  
âœ… **é…ç½®æ–‡ä»¶**: Springã€MyBatisã€æ—¥å¿—é…ç½®  
âœ… **Mapper æ–‡ä»¶**: SQL è¯­å¥å®šä¹‰  
âœ… **åŠŸèƒ½å¯¹åº”**: åŠŸèƒ½ä¸ä»£ç çš„æ˜ å°„å…³ç³»  

é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ å¯ä»¥ï¼š
- ğŸ¯ å¿«é€Ÿå®šä½åŠŸèƒ½å¯¹åº”çš„ä»£ç ä½ç½®
- ğŸ“š ç†è§£æ¯ä¸ªç±»å’Œæ–¹æ³•çš„ä½œç”¨
- ğŸ” å­¦ä¹  SSM æ¡†æ¶çš„å®é™…åº”ç”¨
- ğŸ’¡ æŒæ¡ Web é¡¹ç›®çš„å¼€å‘æµç¨‹

å¸Œæœ›è¿™ä»½è¯¦è§£èƒ½å¸®åŠ©ä½ æ·±å…¥ç†è§£é¡¹ç›®ä»£ç ï¼

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2026-01-17  
**ä½œè€…**: Hotel Management System Team
